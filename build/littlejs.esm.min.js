const e=Math.PI,t=e=>e<0?-e:e,i=(e,t)=>e<t?e:t,s=(e,t)=>e>t?e:t,a=e=>e<0?-1:1,n=(e,t=1)=>(e%t+t)%t,o=(e,t=0,i=1)=>e<t?t:e>i?i:e,l=(e,t=0,i=1)=>i-t?o((e-t)/(i-t)):0,r=(e,t=0,i=1)=>t+o(e)*(i-t),c=e=>e*e*(3-2*e),h=e=>2**Math.ceil(Math.log2(e)),d=(e,i,s,a)=>2*t(e.x-s.x)<i.x+a.x&&2*t(e.y-s.y)<i.y+a.y,u=(t=1,i=1,s=time)=>i/2*(1-Math.cos(s*t*2*e)),m=e=>(e/60|0)+":"+(e%60<10?"0":"")+(e%60|0),g=(e=1,t=0)=>t+(e-t)*Math.random(),p=(e=1,t=0)=>0|g(e,t),y=()=>2*p(2)-1,S=(e=1,t=0)=>e>0?x(e*g(t/e,1)**.5):new z,x=(t=1)=>(new z).setAngle(g(2*e),t),f=(e=new D,t=new D(0,0,0,1),i)=>i?e.lerp(t,g()):new D(g(e.r,t.r),g(e.g,t.g),g(e.b,t.b),g(e.a,t.a));let v=1;const b=e=>v=e,C=(e=1,i=0)=>(v^=v<<13,v^=v>>>17,v^=v<<5,i+(e-i)*t(v%1e9)/1e9),w=(e=0,t)=>null==e.x?new z(e,null==t?e:t):new z(e.x,e.y),A=e=>!isNaN(e.x)&&!isNaN(e.y);class z{constructor(e=0,t=0){this.x=e,this.y=t}copy(){return new z(this.x,this.y)}add(e){return ASSERT(A(e)),new z(this.x+e.x,this.y+e.y)}subtract(e){return ASSERT(A(e)),new z(this.x-e.x,this.y-e.y)}multiply(e){return ASSERT(A(e)),new z(this.x*e.x,this.y*e.y)}divide(e){return ASSERT(A(e)),new z(this.x/e.x,this.y/e.y)}scale(e){return ASSERT(!A(e)),new z(this.x*e,this.y*e)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(e){return this.distanceSquared(e)**.5}distanceSquared(e){return(this.x-e.x)**2+(this.y-e.y)**2}normalize(e=1){const t=this.length();return t?this.scale(e/t):new z(0,e)}clampLength(e=1){const t=this.length();return t>e?this.scale(e/t):this}dot(e){return ASSERT(A(e)),this.x*e.x+this.y*e.y}cross(e){return ASSERT(A(e)),this.x*e.y-this.y*e.x}angle(){return Math.atan2(this.x,this.y)}setAngle(e=0,t=1){return this.x=t*Math.sin(e),this.y=t*Math.cos(e),this}rotate(e){const t=Math.cos(e),i=Math.sin(e);return new z(this.x*t-this.y*i,this.x*i+this.y*t)}direction(){return t(this.x)>t(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new z(this.y,-this.x)}floor(){return new z(Math.floor(this.x),Math.floor(this.y))}area(){return t(this.x*this.y)}lerp(e,t){return ASSERT(A(e)),this.add(e.subtract(this).scale(o(t)))}arrayCheck(e){return this.x>=0&&this.y>=0&&this.x<e.x&&this.y<e.y}toString(e=3){if(debug)return`(${(this.x<0?"":" ")+this.x.toFixed(e)},${(this.y<0?"":" ")+this.y.toFixed(e)} )`}}const T=(e,t,i,s)=>new D(e,t,i,s),E=(e,t,i,s)=>(new D).setHSLA(e,t,i,s);class D{constructor(e=1,t=1,i=1,s=1){this.r=e,this.g=t,this.b=i,this.a=s}copy(){return new D(this.r,this.g,this.b,this.a)}add(e){return new D(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}subtract(e){return new D(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}multiply(e){return new D(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}divide(e){return new D(this.r/e.r,this.g/e.g,this.b/e.b,this.a/e.a)}scale(e,t=e){return new D(this.r*e,this.g*e,this.b*e,this.a*t)}clamp(){return new D(o(this.r),o(this.g),o(this.b),o(this.a))}lerp(e,t){return this.add(e.subtract(this).scale(o(t)))}setHSLA(e=0,t=0,i=1,s=1){const a=i<.5?i*(1+t):i+t-i*t,n=2*i-a,o=(e,t,i)=>(i=(i%1+1)%1)<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e;return this.r=o(n,a,e+1/3),this.g=o(n,a,e),this.b=o(n,a,e-1/3),this.a=s,this}getHSLA(){const e=o(this.r),t=o(this.g),i=o(this.b),s=o(this.a),a=Math.max(e,t,i),n=Math.min(e,t,i),l=(a+n)/2;let r=0,c=0;if(a!=n){let s=a-n;c=l>.5?s/(2-a-n):s/(a+n),e==a?r=(t-i)/s+(t<i?6:0):t==a?r=(i-e)/s+2:i==a&&(r=(e-t)/s+4)}return[r/6,c,l,s]}mutate(e=.05,t=0){return new D(this.r+g(e,-e),this.g+g(e,-e),this.b+g(e,-e),this.a+g(t,-t)).clamp()}toString(e=1){const t=e=>((e=255*e|0)<16?"0":"")+e.toString(16);return"#"+t(this.r)+t(this.g)+t(this.b)+(e?t(this.a):"")}setHex(e){const t=t=>o(parseInt(e.slice(t,t+2),16)/255);return this.r=t(1),this.g=t(3),this.b=t(5),this.a=e.length>7?t(7):1,this}rgbaInt(){const e=e=>255*o(e)|0;return e(this.r)+(e(this.g)<<8)+(e(this.b)<<16)+(e(this.a)<<24)}}class I{constructor(e){this.time=null==e?void 0:time+e,this.setTime=e}set(e=0){this.time=time+e,this.setTime=e}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return time<=this.time}elapsed(){return time>this.time}get(){return this.isSet()?time-this.time:0}getPercent(){return this.isSet()?l(this.time-time,this.setTime,0):0}toString(){if(debug)return this.unset()?"unset":Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after")}valueOf(){return this.get()}}const M="LittleJS",R="1.6.3",P=60,B=1/P;let O=[],F=[],j=0,k=0,G=0,W=0;function L(e){W=e}function _(e,t,i,s,a,n){tileImage.onerror=tileImage.onload=()=>{tileImageFixBleed=w(tileFixBleedScale).divide(tileImageSize=w(tileImage.width,tileImage.height)),debug&&(tileImage.onload=()=>ASSERT(1));document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none",document.body.appendChild(mainCanvas=document.createElement("canvas")),mainContext=mainCanvas.getContext("2d"),debugInit(),glEnable&&glInit(),document.body.appendChild(overlayCanvas=document.createElement("canvas")),overlayContext=overlayCanvas.getContext("2d");(glCanvas||mainCanvas).style=mainCanvas.style=overlayCanvas.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",e(),c()};let o,l,r=0;function c(e=0){let n=e-r;r=e,(debug||showWatermark)&&(l=lerp(.05,l,1e3/(n||1)));const h=debug&&keyIsDown(107),d=debug&&keyIsDown(109);if(debug&&(n*=h?5:d?.2:1),G+=n/1e3,o+=!W*n,h||(o=min(o,50)),canvasFixedSize.x){mainCanvas.width=canvasFixedSize.x,mainCanvas.height=canvasFixedSize.y;const e=innerWidth/innerHeight,t=mainCanvas.width/mainCanvas.height;(glCanvas||mainCanvas).style.width=mainCanvas.style.width=overlayCanvas.style.width=e<t?"100%":"",(glCanvas||mainCanvas).style.height=mainCanvas.style.height=overlayCanvas.style.height=e<t?"":"100%"}else mainCanvas.width=min(innerWidth,canvasMaxSize.x),mainCanvas.height=min(innerHeight,canvasMaxSize.y);if(overlayCanvas.width=mainCanvas.width,overlayCanvas.height=mainCanvas.height,mainCanvasSize=w(mainCanvas.width,mainCanvas.height),W)inputUpdate(),debugUpdate(),i(),inputUpdatePost();else{let e=0;for(o<0&&o>-9&&(e=o,o=0);o>=0;o-=1e3/P)inputUpdate(),t(),K(),debugUpdate(),i(),inputUpdatePost();o+=e}mainCanvasSize=w(mainCanvas.width,mainCanvas.height),mainContext.imageSmoothingEnabled=!cavasPixelated,glEnable&&glPreRender(),s(),O.sort(((e,t)=>e.renderOrder-t.renderOrder));for(const e of O)e.destroyed||e.render();if(a(),glRenderPostProcess(),medalsRender(),touchGamepadRender(),debugRender(),glEnable&&glCopyToContext(mainContext),showWatermark){overlayContext.textAlign="right",overlayContext.textBaseline="top",overlayContext.font="1em monospace",overlayContext.fillStyle="#000";const e=M+" v"+R+" / "+drawCount+" / "+O.length+" / "+l.toFixed(1)+(glEnable?" GL":" 2D");overlayContext.fillText(e,mainCanvas.width-3,3),overlayContext.fillStyle="#fff",overlayContext.fillText(e,mainCanvas.width-2,2),drawCount=0}requestAnimationFrame(c)}n?tileImage.src=n:tileImage.onload()}function K(){F=O.filter((e=>e.collideSolidObjects));const e=t=>{if(!t.destroyed){t.update();for(const i of t.children)e(i)}};for(const t of O)t.parent||e(t);O=O.filter((e=>!e.destroyed)),k=++j/P}function N(){for(const e of O)e.parent||e.destroy();O=O.filter((e=>!e.destroyed))}function U(e,t,i,s=O){if(e)if(null!=t.x)for(const a of s)isOverlapping(e,t,a.pos,a.size)&&i(a);else{const a=t*t;for(const t of s)e.distanceSquared(t.pos)<a&&i(t)}else for(const e of s)i(e)}class H{constructor(e,t=soundDefaultRange,i=soundDefaultTaper){soundEnable&&(this.range=t,this.taper=i,this.randomness=e[1]||0,e[1]=0,this.cachedSamples=te(...e))}play(e,t=1,i=1,s=1){if(!soundEnable)return;let a;if(e){const i=this.range;if(i){const s=cameraPos.distanceSquared(e);if(s>i*i)return;t*=percent(s**.5,i,i*this.taper)}a=2*worldToScreen(e).x/mainCanvas.width-1}const n=i+i*this.randomness*s*rand(-1,1);return Z([this.cachedSamples],t,n,a)}playNote(e,t,i){if(soundEnable)return this.play(t,i,2**(e/12),0)}}class Y{constructor(e){soundEnable&&(this.cachedSamples=function(e,t,i,s=125){let a,n,o,l,r,c,h,d,u,m,g,p,y,S,x=0,f=[],v=[],b=[],C=0,w=0,A=1,z={},T=ee/s*60>>2;for(;A;C++)f=[A=d=p=0],i.forEach(((s,E)=>{for(h=t[s][C]||[0,0,0],A|=!!t[s][C],S=p+(t[s][0].length-2-!d)*T,y=E==i.length-1,a=2,o=p;a<h.length+y;d=++a){for(r=h[a],u=a==h.length+y-1&&y||m!=(h[0]||0)|r|0,n=0;n<T&&d;n++>T-99&&u?g+=(g<1)/99:0)c=(1-g)*f[x++]/2||0,v[o]=(v[o]||0)-c*w+c,b[o]=(b[o++]||0)+c*w+c;r&&(g=r%1,w=h[1]||0,(r|=0)&&(f=z[[m=h[x=0]||0,r]]=z[[m,r]]||(l=[...e[m]],l[2]*=2**((r-12)/12),r>0?te(...l):[])))}p=S}));return[v,b]}(...e))}play(e,t=1){if(soundEnable)return this.source=Z(this.cachedSamples,e,1,0,t)}stop(){this.source&&this.source.stop(),this.source=0}isPlaying(){return this.source}}function J(e,t=1,i=1){if(!soundEnable)return;const s=new Audio(e);return s.volume=soundVolume*t,s.loop=i,s.play(),s}function X(e,t="",i=1,s=1,a=1){if(!soundEnable||!speechSynthesis)return;const n=new SpeechSynthesisUtterance(e);return n.lang=t,n.volume=2*i*soundVolume,n.rate=s,n.pitch=a,speechSynthesis.speak(n),n}const Q=()=>speechSynthesis&&speechSynthesis.cancel(),q=(e,t=220)=>t*2**(e/12);let V;function Z(e,t=1,i=1,s=0,a=0){if(!soundEnable)return;if(V||(V=new AudioContext),V.resume(),"running"!=V.state)return;const n=V.createBuffer(e.length,e[0].length,ee),o=V.createBufferSource();e.forEach(((e,t)=>n.getChannelData(t).set(e))),o.buffer=n,o.playbackRate.value=i,o.loop=a;const l=V.createGain();return l.gain.value=soundVolume*t,l.connect(V.destination),o.connect(new StereoPannerNode(V,{pan:clamp(s,-1,1)})).connect(l),o.start(),o}const $=(...e)=>Z([te(...e)]),ee=44100;function te(e=1,t=.05,i=220,s=0,a=0,n=.1,o=0,l=1,r=0,c=0,h=0,d=0,u=0,m=0,g=0,p=0,y=0,S=1,x=0,f=0){let v,b,C=2*PI,w=r*=500*C/ee/ee,A=[],z=i*=(1+t*rand(-1,1))*C/ee,T=0,E=0,D=0,I=1,M=0,R=0,P=0;for(c*=500*C/ee**3,g*=C/ee,h*=C/ee,d*=ee,u=u*ee|0,b=(s=s*ee+9)+(x*=ee)+(a*=ee)+(n*=ee)+(y*=ee)|0;D<b;A[D++]=P)++R%(100*p|0)||(P=o?o>1?o>2?o>3?Math.sin((T%C)**3):max(min(Math.tan(T),1),-1):1-(2*T/C%2+2)%2:1-4*abs(Math.round(T/C)-T/C):Math.sin(T),P=(u?1-f+f*Math.sin(C*D/u):1)*sign(P)*abs(P)**l*e*soundVolume*(D<s?D/s:D<s+x?1-(D-s)/x*(1-S):D<s+x+a?S:D<b-y?(b-D-y)/n*S:0),P=y?P/2+(y>D?0:(D<b-y?1:(b-D)/y)*A[D-y|0]/2):P),v=(i+=r+=c)*Math.cos(g*E++),T+=v-v*m*(1-1e9*(Math.sin(D)+1)%2),I&&++I>d&&(i+=h,z+=h,I=0),!u||++M%u||(i=z,r=w,I||=1);return A}let ie,se,ae,ne,oe=w();const le=new Image;let re,ce;const he=e=>(ASSERT(oe.x&&oe.y,"mainCanvasSize is invalid"),e.add(w(.5)).subtract(oe.scale(.5)).multiply(w(1/cameraScale,-1/cameraScale)).add(cameraPos)),de=e=>(ASSERT(oe.x&&oe.y,"mainCanvasSize is invalid"),e.subtract(cameraPos).multiply(w(cameraScale,-cameraScale)).add(oe.scale(.5)).subtract(w(.5)));function ue(e,t=w(1),i=-1,s=tileSizeDefault,a=new D,n=0,o,l=new D(0,0,0,0),r=glEnable){if(showWatermark&&0,glEnable&&r)if(i<0||!le.width)glDraw(e.x,e.y,t.x,t.y,n,0,0,0,0,0,a.rgbaInt());else{const r=re.x/s.x|0,c=s.x/re.x,h=s.y/re.y,d=i%r*c,u=(i/r|0)*h;glDraw(e.x,e.y,o?-t.x:t.x,t.y,n,d+ce.x,u+ce.y,d-ce.x+c,u-ce.y+h,a.rgbaInt(),l.rgbaInt())}else Se(e,t,n,o,(e=>{if(i<0)e.fillStyle=a,e.fillRect(-.5,-.5,1,1);else{const t=re.x/s.x|0,n=i%t*s.x+tileFixBleedScale,o=(i/t|0)*s.y+tileFixBleedScale,l=s.x-2*tileFixBleedScale,r=s.y-2*tileFixBleedScale;e.globalAlpha=a.a,e.drawImage(le,n,o,l,r,-.5,-.5,1,1)}}))}function me(e,t,i,s,a){ue(e,t,-1,tileSizeDefault,i,s,0,0,a)}function ge(e,t=w(1),i,s,a,n,o,l,r){ue(he(e),t.scale(1/cameraScale),i,s,a,n,o,l,r)}function pe(e,t,i,s,a){ge(e,t,-1,tileSizeDefault,i,s,0,0,a)}function ye(e,t,i=.1,s,a){const n=w((t.x-e.x)/2,(t.y-e.y)/2),o=w(i,2*n.length());me(e.add(n),o,s,n.angle(),a)}function Se(e,t,i,s,a,n=se){e=de(e),t=t.scale(cameraScale),n.save(),n.translate(e.x+.5|0,e.y+.5|0),n.rotate(i),n.scale(s?-t.x:t.x,t.y),a(n),n.restore()}function xe(e,t=glEnable){glEnable&&t?glSetBlendMode(e):se.globalCompositeOperation=e?"lighter":"source-over"}function fe(e,t,i=1,s,a=0,n,o,l,r){ve(e,de(t),i*cameraScale,s,a*cameraScale,n,o,l,r)}function ve(e,t,i=1,s=new D,a=0,n=new D(0,0,0),o="center",l=fontDefault,r=ne){r.fillStyle=s,r.lineWidth=a,r.strokeStyle=n,r.textAlign=o,r.font=i+"px "+l,r.textBaseline="middle",r.lineJoin="round",t=t.copy(),(e+"").split("\n").forEach((e=>{a&&r.strokeText(e,t.x,t.y),r.fillText(e,t.x,t.y),t.y+=i}))}let be;class Ce{constructor(e,t=w(8),i=w(0,1),s=0,a=ne){be||((be=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=e||be,this.tileSize=t,this.paddingSize=i,this.startTileIndex=s,this.context=a}drawTextScreen(e,t,i=4,s){const a=this.context;a.save(),a.imageSmoothingEnabled=!cavasPixelated;const n=this.tileSize,o=n.add(this.paddingSize).scale(i),l=this.image.width/this.tileSize.x|0;(e+"").split("\n").forEach(((e,r)=>{const c=s?e.length*n.x*i/2|0:0;for(let s=e.length;s--;){let h=e[s].charCodeAt();(h<32||h>127)&&(h=127);const d=this.startTileIndex+h-32,u=d%l,m=d/l|0,g=t.add(w(s,r).multiply(o));a.drawImage(this.image,u*n.x,m*n.y,n.x,n.y,g.x-c,g.y,n.x*i,n.y*i)}})),a.restore()}drawText(e,t,i=1,s){this.drawTextScreen(e,de(t).floor(),i*cameraScale|0,s)}}const we=()=>document.fullscreenElement;function Ae(){we()?document.exitFullscreen&&document.exitFullscreen():document.body.requestFullscreen&&document.body.requestFullscreen()}const ze=e=>cameraPos=e,Te=e=>cameraScale=e,Ee=e=>canvasMaxSize=e,De=e=>canvasFixedSize=e,Ie=e=>cavasPixelated=e,Me=e=>fontDefault=e,Re=e=>glEnable=e,Pe=e=>glOverlay=e,Be=e=>tileSizeDefault=e,Oe=e=>tileFixBleedScale=e,Fe=e=>enablePhysicsSolver=e,je=e=>objectDefaultMass=e,ke=e=>objectDefaultDamping=e,Ge=e=>objectDefaultAngleDamping=e,We=e=>objectDefaultElasticity=e,Le=e=>objectDefaultFriction=e,_e=e=>objectMaxSpeed=e,Ke=e=>gravity=e,Ne=e=>particleEmitRateScale=e,Ue=e=>gamepadsEnable=e,He=e=>gamepadDirectionEmulateStick=e,Ye=e=>inputWASDEmulateDirection=e,Je=e=>touchGamepadEnable=e,Xe=e=>touchGamepadAnalog=e,Qe=e=>touchGamepadSize=e,qe=e=>touchGamepadAlpha=e,Ve=e=>vibrateEnable=e,Ze=e=>soundEnable=e,$e=e=>soundVolume=e,et=e=>soundDefaultRange=e,tt=e=>soundDefaultTaper=e,it=e=>medalDisplayTime=e,st=e=>medalDisplaySlideTime=e,at=e=>medalDisplaySize=e,nt=e=>medalDisplayIconSize=e,ot=e=>medalsPreventUnlock=e,lt=e=>showWatermark=e,rt=e=>godMode=e,ct=e=>debugKey=e,ht=[];let dt,ut;function mt(e){dt=e,debugMedals||ht.forEach((e=>e.unlocked=0|localStorage[e.storageKey()]))}class gt{constructor(e,t,i="",s="🏆",a){ASSERT(e>=0&&!ht[e]),ht[this.id=e]=this,this.name=t,this.description=i,this.icon=s,a&&((this.image=new Image).src=a)}unlock(){medalsPreventUnlock||this.unlocked||(ASSERT(dt),localStorage[this.storageKey()]=this.unlocked=1,ut&&ut.unlockMedal(this.id))}render(e=0){const t=overlayContext,i=min(medalDisplaySize.x,mainCanvas.width),s=overlayCanvas.width-i,a=-medalDisplaySize.y*e;t.save(),t.beginPath(),t.fillStyle=new D(.9,.9,.9),t.strokeStyle=new D(0,0,0),t.lineWidth=3,t.fill(t.rect(s,a,i,medalDisplaySize.y)),t.stroke(),t.clip(),this.renderIcon(w(s+15+medalDisplayIconSize/2,a+medalDisplaySize.y/2));const n=w(s+medalDisplayIconSize+30,a+28);drawTextScreen(this.name,n,38,new D(0,0,0),0,0,"left"),n.y+=32,drawTextScreen(this.description,n,24,new D(0,0,0),0,0,"left"),t.restore()}renderIcon(e,t=medalDisplayIconSize){this.image?overlayContext.drawImage(this.image,e.x-t/2,e.y-t/2,t,t):drawTextScreen(this.icon,e,.7*t,new D(0,0,0))}storageKey(){return dt+"_"+this.id}}function pt(e,t){ut=new yt(e,t)}class yt{constructor(e,t){ASSERT(!ut&&e),this.app_id=e,this.cipher=t,this.host=location?location.hostname:"",t&&(this.cryptoJS=this.CryptoJS());const i=new URL(location.href);if(this.session_id=i.searchParams.get("ngio_session_id"),!this.session_id)return;const s=this.call("Medal.getList");this.medals=s?s.result.data.medals:[],debugMedals&&console.log(this.medals);for(const e of this.medals){const t=ht[e.id];t&&(t.image=new Image,t.image.src=e.icon,t.name=e.name,t.description=e.description,t.unlocked=e.unlocked,t.difficulty=e.difficulty,t.value=e.value,t.value&&(t.description=t.description+" ("+t.value+")"))}const a=this.call("ScoreBoard.getBoards");this.scoreboards=a?a.result.data.scoreboards:[],debugMedals&&console.log(this.scoreboards);setInterval((()=>this.call("Gateway.ping",0,1)),3e5)}unlockMedal(e){return this.call("Medal.unlock",{id:e},1)}postScore(e,t){return this.call("ScoreBoard.postScore",{id:e,value:t},1)}getScores(e,t=0,i=0,s=0,a=10){return this.call("ScoreBoard.getScores",{id:e,user:t,social:i,skip:s,limit:a})}logView(){return this.call("App.logView",{host:this.host},1)}call(e,t=0,i=0){const s={component:e,parameters:t};if(this.cipher){const e=this.cryptoJS,t=e.enc.Base64.parse(this.cipher),i=e.lib.WordArray.random(16),a=e.AES.encrypt(JSON.stringify(s),t,{iv:i});s.secure=e.enc.Base64.stringify(i.concat(a.ciphertext)),s.parameters=0}const a={app_id:this.app_id,session_id:this.session_id,call:s},n=new FormData;n.append("input",JSON.stringify(a));const o=new XMLHttpRequest;return o.open("POST","https://newgrounds.io/gateway_v3.php",!debugMedals&&i),o.send(n),debugMedals&&console.log(o.responseText),o.responseText&&JSON.parse(o.responseText)}CryptoJS(){return Function("[M='GBMGXz^oVYPPKKbB`agTXU|LxPc_ZBcMrZvCr~wyGfWrwk@ATqlqeTp^N?p{we}jIpEnB_sEr`l?YDkDhWhprc|Er|XETG?pTl`e}dIc[_N~}fzRycIfpW{HTolvoPB_FMe_eH~BTMx]yyOhv?biWPCGc]kABencBhgERHGf{OL`Dj`c^sh@canhy[secghiyotcdOWgO{tJIE^JtdGQRNSCrwKYciZOa]Y@tcRATYKzv|sXpboHcbCBf`}SKeXPFM|RiJsSNaIb]QPc[D]Jy_O^XkOVTZep`ONmntLL`Qz~UupHBX_Ia~WX]yTRJIxG`ioZ{fefLJFhdyYoyLPvqgH?b`[TMnTwwfzDXhfM?rKs^aFr|nyBdPmVHTtAjXoYUloEziWDCw_suyYT~lSMksI~ZNCS[Bex~j]Vz?kx`gdYSEMCsHpjbyxQvw|XxX_^nQYue{sBzVWQKYndtYQMWRef{bOHSfQhiNdtR{o?cUAHQAABThwHPT}F{VvFmgN`E@FiFYS`UJmpQNM`X|tPKHlccT}z}k{sACHL?Rt@MkWplxO`ASgh?hBsuuP|xD~LSH~KBlRs]t|l|_tQAroDRqWS^SEr[sYdPB}TAROtW{mIkE|dWOuLgLmJrucGLpebrAFKWjikTUzS|j}M}szasKOmrjy[?hpwnEfX[jGpLt@^v_eNwSQHNwtOtDgWD{rk|UgASs@mziIXrsHN_|hZuxXlPJOsA^^?QY^yGoCBx{ekLuZzRqQZdsNSx@ezDAn{XNj@fRXIwrDX?{ZQHwTEfu@GhxDOykqts|n{jOeZ@c`dvTY?e^]ATvWpb?SVyg]GC?SlzteilZJAL]mlhLjYZazY__qcVFYvt@|bIQnSno@OXyt]OulzkWqH`rYFWrwGs`v|~XeTsIssLrbmHZCYHiJrX}eEzSssH}]l]IhPQhPoQ}rCXLyhFIT[clhzYOvyHqigxmjz`phKUU^TPf[GRAIhNqSOdayFP@FmKmuIzMOeoqdpxyCOwCthcLq?n`L`tLIBboNn~uXeFcPE{C~mC`h]jUUUQe^`UqvzCutYCgct|SBrAeiYQW?X~KzCz}guXbsUw?pLsg@hDArw?KeJD[BN?GD@wgFWCiHq@Ypp_QKFixEKWqRp]oJFuVIEvjDcTFu~Zz]a{IcXhWuIdMQjJ]lwmGQ|]g~c]Hl]pl`Pd^?loIcsoNir_kikBYyg?NarXZEGYspt_vLBIoj}LI[uBFvm}tbqvC|xyR~a{kob|HlctZslTGtPDhBKsNsoZPuH`U`Fqg{gKnGSHVLJ^O`zmNgMn~{rsQuoymw^JY?iUBvw_~mMr|GrPHTERS[MiNpY[Mm{ggHpzRaJaoFomtdaQ_?xuTRm}@KjU~RtPsAdxa|uHmy}n^i||FVL[eQAPrWfLm^ndczgF~Nk~aplQvTUpHvnTya]kOenZlLAQIm{lPl@CCTchvCF[fI{^zPkeYZTiamoEcKmBMfZhk_j_~Fjp|wPVZlkh_nHu]@tP|hS@^G^PdsQ~f[RqgTDqezxNFcaO}HZhb|MMiNSYSAnQWCDJukT~e|OTgc}sf[cnr?fyzTa|EwEtRG|I~|IO}O]S|rp]CQ}}DWhSjC_|z|oY|FYl@WkCOoPuWuqr{fJu?Brs^_EBI[@_OCKs}?]O`jnDiXBvaIWhhMAQDNb{U`bqVR}oqVAvR@AZHEBY@depD]OLh`kf^UsHhzKT}CS}HQKy}Q~AeMydXPQztWSSzDnghULQgMAmbWIZ|lWWeEXrE^EeNoZApooEmrXe{NAnoDf`m}UNlRdqQ@jOc~HLOMWs]IDqJHYoMziEedGBPOxOb?[X`KxkFRg@`mgFYnP{hSaxwZfBQqTm}_?RSEaQga]w[vxc]hMne}VfSlqUeMo_iqmd`ilnJXnhdj^EEFifvZyxYFRf^VaqBhLyrGlk~qowqzHOBlOwtx?i{m~`n^G?Yxzxux}b{LSlx]dS~thO^lYE}bzKmUEzwW^{rPGhbEov[Plv??xtyKJshbG`KuO?hjBdS@Ru}iGpvFXJRrvOlrKN?`I_n_tplk}kgwSXuKylXbRQ]]?a|{xiT[li?k]CJpwy^o@ebyGQrPfF`aszGKp]baIx~H?ElETtFh]dz[OjGl@C?]VDhr}OE@V]wLTc[WErXacM{We`F|utKKjgllAxvsVYBZ@HcuMgLboFHVZmi}eIXAIFhS@A@FGRbjeoJWZ_NKd^oEH`qgy`q[Tq{x?LRP|GfBFFJV|fgZs`MLbpPYUdIV^]mD@FG]pYAT^A^RNCcXVrPsgk{jTrAIQPs_`mD}rOqAZA[}RETFz]WkXFTz_m{N@{W@_fPKZLT`@aIqf|L^Mb|crNqZ{BVsijzpGPEKQQZGlApDn`ruH}cvF|iXcNqK}cxe_U~HRnKV}sCYb`D~oGvwG[Ca|UaybXea~DdD~LiIbGRxJ_VGheI{ika}KC[OZJLn^IBkPrQj_EuoFwZ}DpoBRcK]Q}?EmTv~i_Tul{bky?Iit~tgS|o}JL_VYcCQdjeJ_MfaA`FgCgc[Ii|CBHwq~nbJeYTK{e`CNstKfTKPzw{jdhp|qsZyP_FcugxCFNpKitlR~vUrx^NrSVsSTaEgnxZTmKc`R|lGJeX}ccKLsQZQhsFkeFd|ckHIVTlGMg`~uPwuHRJS_CPuN_ogXe{Ba}dO_UBhuNXby|h?JlgBIqMKx^_u{molgL[W_iavNQuOq?ap]PGB`clAicnl@k~pA?MWHEZ{HuTLsCpOxxrKlBh]FyMjLdFl|nMIvTHyGAlPogqfZ?PlvlFJvYnDQd}R@uAhtJmDfe|iJqdkYr}r@mEjjIetDl_I`TELfoR|qTBu@Tic[BaXjP?dCS~MUK[HPRI}OUOwAaf|_}HZzrwXvbnNgltjTwkBE~MztTQhtRSWoQHajMoVyBBA`kdgK~h`o[J`dm~pm]tk@i`[F~F]DBlJKklrkR]SNw@{aG~Vhl`KINsQkOy?WhcqUMTGDOM_]bUjVd|Yh_KUCCgIJ|LDIGZCPls{RzbVWVLEhHvWBzKq|^N?DyJB|__aCUjoEgsARki}j@DQXS`RNU|DJ^a~d{sh_Iu{ONcUtSrGWW@cvUjefHHi}eSSGrNtO?cTPBShLqzwMVjWQQCCFB^culBjZHEK_{dO~Q`YhJYFn]jq~XSnG@[lQr]eKrjXpG~L^h~tDgEma^AUFThlaR{xyuP@[^VFwXSeUbVetufa@dX]CLyAnDV@Bs[DnpeghJw^?UIana}r_CKGDySoRudklbgio}kIDpA@McDoPK?iYcG?_zOmnWfJp}a[JLR[stXMo?_^Ng[whQlrDbrawZeSZ~SJstIObdDSfAA{MV}?gNunLOnbMv_~KFQUAjIMj^GkoGxuYtYbGDImEYiwEMyTpMxN_LSnSMdl{bg@dtAnAMvhDTBR_FxoQgANniRqxd`pWv@rFJ|mWNWmh[GMJz_Nq`BIN@KsjMPASXORcdHjf~rJfgZYe_uulzqM_KdPlMsuvU^YJuLtofPhGonVOQxCMuXliNvJIaoC?hSxcxKVVxWlNs^ENDvCtSmO~WxI[itnjs^RDvI@KqG}YekaSbTaB]ki]XM@[ZnDAP~@|BzLRgOzmjmPkRE@_sobkT|SszXK[rZN?F]Z_u}Yue^[BZgLtR}FHzWyxWEX^wXC]MJmiVbQuBzkgRcKGUhOvUc_bga|Tx`KEM`JWEgTpFYVeXLCm|mctZR@uKTDeUONPozBeIkrY`cz]]~WPGMUf`MNUGHDbxZuO{gmsKYkAGRPqjc|_FtblEOwy}dnwCHo]PJhN~JoteaJ?dmYZeB^Xd?X^pOKDbOMF@Ugg^hETLdhwlA}PL@_ur|o{VZosP?ntJ_kG][g{Zq`Tu]dzQlSWiKfnxDnk}KOzp~tdFstMobmy[oPYjyOtUzMWdjcNSUAjRuqhLS@AwB^{BFnqjCmmlk?jpn}TksS{KcKkDboXiwK]qMVjm~V`LgWhjS^nLGwfhAYrjDSBL_{cRus~{?xar_xqPlArrYFd?pHKdMEZzzjJpfC?Hv}mAuIDkyBxFpxhstTx`IO{rp}XGuQ]VtbHerlRc_LFGWK[XluFcNGUtDYMZny[M^nVKVeMllQI[xtvwQnXFlWYqxZZFp_|]^oWX[{pOMpxXxvkbyJA[DrPzwD|LW|QcV{Nw~U^dgguSpG]ClmO@j_TENIGjPWwgdVbHganhM?ema|dBaqla|WBd`poj~klxaasKxGG^xbWquAl~_lKWxUkDFagMnE{zHug{b`A~IYcQYBF_E}wiA}K@yxWHrZ{[d~|ARsYsjeNWzkMs~IOqqp[yzDE|WFrivsidTcnbHFRoW@XpAV`lv_zj?B~tPCppRjgbbDTALeFaOf?VcjnKTQMLyp{NwdylHCqmo?oelhjWuXj~}{fpuX`fra?GNkDiChYgVSh{R[BgF~eQa^WVz}ATI_CpY?g_diae]|ijH`TyNIF}|D_xpmBq_JpKih{Ba|sWzhnAoyraiDvk`h{qbBfsylBGmRH}DRPdryEsSaKS~tIaeF[s]I~xxHVrcNe@Jjxa@jlhZueLQqHh_]twVMqG_EGuwyab{nxOF?`HCle}nBZzlTQjkLmoXbXhOtBglFoMz?eqre`HiE@vNwBulglmQjj]DB@pPkPUgA^sjOAUNdSu_`oAzar?n?eMnw{{hYmslYi[TnlJD'",..."]charCodeAtUinyxpf","for(;e<10359;c[e++]=p-=128,A=A?p-A&&A:p==34&&p)for(p=1;p<128;y=f.map((n,x)=>(U=r[n]*2+1,U=Math.log(U/(h-U)),t-=a[x]*U,U/500)),t=~-h/(1+Math.exp(t))|1,i=o%h<t,o=o%h+(i?t:h-t)*(o>>17)-!i*t,f.map((n,x)=>(U=r[n]+=(i*h/2-r[n]<<13)/((C[n]+=C[n]<5)+1/20)>>13,a[x]+=y[x]*(i-t/h))),p=p*2+i)for(f='010202103203210431053105410642065206541'.split(t=0).map((n,x)=>(U=0,[...n].map((n,x)=>(U=U*997+(c[e-n]|0)|0)),h*32-1&U*997+p+!!A*129)*12+x);o<h*32;o=o*64|M.charCodeAt(d++)&63);for(C=String.fromCharCode(...c);r=/[\0-#?@\\\\~]/.exec(C);)with(C.split(r))C=join(shift());return C")([],[],1<<17,[0,0,0,0,0,0,0,0,0,0,0,0],new Uint16Array(51e6).fill(32768),new Uint8Array(51e6),0,0,0,0)()}}const St=(e,t=0)=>Bt[t]&&1&Bt[t][e],xt=(e,t=0)=>Bt[t]&&2&Bt[t][e]?1:0,ft=(e,t=0)=>Bt[t]&&4&Bt[t][e]?1:0,vt=()=>Bt=[[]],bt=St,Ct=xt,wt=ft;let At=w(),zt=w(),Tt=0,Et=0,Dt=0;const It=(e,t=0)=>St(e,t+1),Mt=(e,t=0)=>xt(e,t+1),Rt=(e,t=0)=>ft(e,t+1),Pt=(e,t=0)=>jt[t]&&jt[t][e]||w();let Bt=[[]];onkeydown=e=>{debug&&e.target!=document.body||e.repeat||(Bt[Et=0][Ot(e.which)]=3)},onkeyup=e=>{debug&&e.target!=document.body||(Bt[0][Ot(e.which)]=4)};const Ot=e=>inputWASDEmulateDirection?87==e?38:83==e?40:65==e?37:68==e?39:e:e;onmousedown=e=>{Bt[Et=0][e.button]=3,onmousemove(e),e.button&&e.preventDefault()},onmouseup=e=>Bt[0][e.button]=2&Bt[0][e.button]|4,onmousemove=e=>zt=Ft(e),onwheel=e=>e.ctrlKey||(Tt=sign(e.deltaY)),oncontextmenu=e=>!1;const Ft=e=>{if(!mainCanvas)return w();const t=mainCanvas.getBoundingClientRect();return w(mainCanvas.width,mainCanvas.height).multiply(w(percent(e.x,t.left,t.right),percent(e.y,t.top,t.bottom)))},jt=[];function kt(){if(touchGamepadEnable&&Nt.isSet()){(jt[0]||(jt[0]=[]))[0]=w(Kt.x,-Kt.y);const e=Bt[1]||(Bt[1]=[]);for(let t=10;t--;){const i=3==t?2:2==t?3:t;e[i]=_t[t]?1+2*!It(i,0):4*It(i,0)}}if(!gamepadsEnable||!navigator||!navigator.getGamepads||!document.hasFocus()&&!debug)return;const e=navigator.getGamepads();for(let t=e.length;t--;){const i=e[t],s=Bt[t+1]||(Bt[t+1]=[]),a=jt[t]||(jt[t]=[]);if(i){const e=.3,n=.8,o=t=>t>e?percent(t,e,n):t<-e?-percent(-t,e,n):0;for(let e=0;e<i.axes.length-1;e+=2)a[e>>1]=w(o(i.axes[e]),o(-i.axes[e+1])).clampLength();for(let e=i.buttons.length;e--;){const a=i.buttons[e];s[e]=a.pressed?1+2*!It(e,t):4*It(e,t),Et|=!t&&a.pressed,touchGamepadEnable&&Nt.unset()}if(gamepadDirectionEmulateStick){const e=w(It(15,t)-It(14,t),It(12,t)-It(13,t));e.lengthSquared()&&(a[0]=e.clampLength())}}}}const Gt=e=>vibrateEnable&&navigator&&navigator.vibrate&&navigator.vibrate(e),Wt=()=>Gt(0),Lt=void 0!==window.ontouchstart;if(Lt){let e,t=onmousedown,i=onmouseup;onmousedown=onmouseup=()=>0,ontouchstart=s=>(zzfx(0),ontouchstart=ontouchmove=ontouchend=s=>{s.button=0;const a=s.touches.length;return a?(s.x=s.touches[0].clientX,s.y=s.touches[0].clientY,e?onmousemove(s):t(s)):e&&i(s),e=a,!0},touchGamepadEnable&&function(){_t=[],Kt=w();let e=ontouchstart;ontouchstart=ontouchmove=ontouchend=t=>{Kt=w(),_t=[];if(t.touches.length&&(Nt.set(),paused))return void(_t[9]=1);const i=w(touchGamepadSize,mainCanvasSize.y-touchGamepadSize),s=mainCanvasSize.subtract(w(touchGamepadSize,touchGamepadSize)),a=mainCanvasSize.scale(.5);for(const e of t.touches){const t=Ft(w(e.clientX,e.clientY));if(t.distance(i)<touchGamepadSize)if(touchGamepadAnalog)Kt=t.subtract(i).scale(2/touchGamepadSize).clampLength();else{const e=t.subtract(i).angle();Kt.setAngle((4*e/PI+8.5|0)*PI/4)}else if(t.distance(s)<touchGamepadSize){const e=t.subtract(s).direction();_t[e]=1}else t.distance(a)<touchGamepadSize&&(_t[9]=1)}return e(t),Et=1,!0}}(),ontouchstart(s))}let _t,Kt,Nt=new I;let Ut=class{constructor(e=w(),t=w(1),i=-1,s=tileSizeDefault,a=0,n,o=0){ASSERT(isVector2(e)&&isVector2(t)),this.pos=e.copy(),this.size=t,this.drawSize,this.tileIndex=i,this.tileSize=s,this.angle=a,this.color=n,this.additiveColor,this.mass=objectDefaultMass,this.damping=objectDefaultDamping,this.angleDamping=objectDefaultAngleDamping,this.elasticity=objectDefaultElasticity,this.friction=objectDefaultFriction,this.gravityScale=1,this.renderOrder=o,this.velocity=new z,this.angleVelocity=0,this.spawnTime=time,this.children=[],this.collideTiles=1,engineObjects.push(this)}update(){const e=this.parent;if(e)return this.pos=this.localPos.multiply(w(e.getMirrorSign(),1)).rotate(-e.angle).add(e.pos),void(this.angle=e.getMirrorSign()*this.localAngle+e.angle);this.velocity.x=clamp(this.velocity.x,-objectMaxSpeed,objectMaxSpeed),this.velocity.y=clamp(this.velocity.y,-objectMaxSpeed,objectMaxSpeed);const t=this.pos.copy();if(this.velocity.y+=gravity*this.gravityScale,this.pos.x+=this.velocity.x*=this.damping,this.pos.y+=this.velocity.y*=this.damping,this.angle+=this.angleVelocity*=this.angleDamping,ASSERT(this.angleDamping>=0&&this.angleDamping<=1),ASSERT(this.damping>=0&&this.damping<=1),!enablePhysicsSolver||!this.mass)return;const i=this.velocity.y<0;if(this.groundObject){const e=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=e+(this.velocity.x-e)*this.friction,this.groundObject=0}if(this.collideSolidObjects){const e=.001;for(const s of engineObjectsCollide){if(!this.isSolid&!s.isSolid||s.destroyed||s.parent||s==this)continue;if(!isOverlapping(this.pos,this.size,s.pos,s.size))continue;if(!this.collideWithObject(s)|!s.collideWithObject(this))continue;if(isOverlapping(t,this.size,s.pos,s.size)){const e=t.subtract(s.pos),i=e.length(),a=.001,n=i<.01?randVector(a):e.scale(a/i);this.velocity=this.velocity.add(n),s.mass&&(s.velocity=s.velocity.subtract(n)),debugOverlay&&debugPhysics&&debugAABB(this.pos,this.size,s.pos,s.size,"#f00");continue}const a=this.size.add(s.size),n=2*(t.y-s.pos.y)>a.y+gravity,o=2*abs(t.y-s.pos.y)<a.y,l=2*abs(t.x-s.pos.x)<a.x,r=max(this.elasticity,s.elasticity);if(n|l|!o)if(this.pos.y=s.pos.y+(a.y/2+e)*sign(t.y-s.pos.y),s.groundObject&&i||!s.mass)i&&(this.groundObject=s),this.velocity.y*=-r;else if(s.mass){const e=(this.mass*this.velocity.y+s.mass*s.velocity.y)/(this.mass+s.mass),t=this.velocity.y*(this.mass-s.mass)/(this.mass+s.mass)+2*s.velocity.y*s.mass/(this.mass+s.mass),i=s.velocity.y*(s.mass-this.mass)/(this.mass+s.mass)+2*this.velocity.y*this.mass/(this.mass+s.mass);this.velocity.y=lerp(r,e,t),s.velocity.y=lerp(r,e,i)}if(!n&o)if(this.pos.x=s.pos.x+(a.x/2+e)*sign(t.x-s.pos.x),s.mass){const e=(this.mass*this.velocity.x+s.mass*s.velocity.x)/(this.mass+s.mass),t=this.velocity.x*(this.mass-s.mass)/(this.mass+s.mass)+2*s.velocity.x*s.mass/(this.mass+s.mass),i=s.velocity.x*(s.mass-this.mass)/(this.mass+s.mass)+2*this.velocity.x*this.mass/(this.mass+s.mass);this.velocity.x=lerp(r,e,t),s.velocity.x=lerp(r,e,i)}else this.velocity.x*=-r;debugOverlay&&debugPhysics&&debugAABB(this.pos,this.size,s.pos,s.size,"#f0f")}}if(this.collideTiles&&tileCollisionTest(this.pos,this.size,this)&&!tileCollisionTest(t,this.size,this)){const e=tileCollisionTest(new z(t.x,this.pos.y),this.size,this),s=tileCollisionTest(new z(this.pos.x,t.y),this.size,this);if(e|!s){this.groundObject=i,this.velocity.y*=-this.elasticity;const e=(t.y-this.size.y/2|0)-(t.y-this.size.y/2);e<0&&e>this.damping*this.velocity.y+gravity*this.gravityScale&&(this.velocity.y=this.damping?(e-gravity*this.gravityScale)/this.damping:0),this.pos.y=t.y}s&&(this.pos.x=t.x,this.velocity.x*=-this.elasticity)}}render(){drawTile(this.pos,this.drawSize||this.size,this.tileIndex,this.tileSize,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const e of this.children)e.destroy(e.parent=0)}}collideWithTile(e,t){return e>0}collideWithTileRaycast(e,t){return e>0}collideWithObject(e){return 1}getAliveTime(){return time-this.spawnTime}applyAcceleration(e){this.mass&&(this.velocity=this.velocity.add(e))}applyForce(e){this.applyAcceleration(e.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(e,t=w(),i=0){ASSERT(!e.parent&&!this.children.includes(e)),this.children.push(e),e.parent=this,e.localPos=t.copy(),e.localAngle=i}removeChild(e){ASSERT(e.parent==this&&this.children.includes(e)),this.children.splice(this.children.indexOf(e),1),e.parent=0}setCollision(e=1,t=1,i=1){ASSERT(e||!t),this.collideSolidObjects=e,this.isSolid=t,this.collideTiles=i}toString(){if(debug){let e="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(e+="\npos = "+this.pos),(this.velocity.x||this.velocity.y)&&(e+="\nvelocity = "+this.velocity),(this.size.x||this.size.y)&&(e+="\nsize = "+this.size),this.angle&&(e+="\nangle = "+this.angle.toFixed(3)),this.color&&(e+="\ncolor = "+this.color),e}}};class Ht extends EngineObject{constructor(e,t,i=0,s=0,a=100,n=PI,o=-1,l=tileSizeDefault,r=new D,c=new D,h=new D(1,1,1,0),d=new D(1,1,1,0),u=.5,m=.1,g=1,p=.1,y=.05,S=1,x=1,f=0,v=PI,b=.1,C=.2,w,A,T=1,E=(A?1e9:0),I){super(e,new z,o,l,t,void 0,E),this.emitSize=i,this.emitTime=s,this.emitRate=a,this.emitConeAngle=n,this.colorStartA=r,this.colorStartB=c,this.colorEndA=h,this.colorEndB=d,this.randomColorLinear=T,this.particleTime=u,this.sizeStart=m,this.sizeEnd=g,this.speed=p,this.angleSpeed=y,this.damping=S,this.angleDamping=x,this.gravityScale=f,this.particleConeAngle=v,this.fadeRate=b,this.randomness=C,this.collideTiles=w,this.additive=A,this.localSpace=I,this.trailScale=0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime|this.getAliveTime()<=this.emitTime){if(this.emitRate*particleEmitRateScale){const e=1/this.emitRate/particleEmitRateScale;for(this.emitTimeBuffer+=timeDelta;this.emitTimeBuffer>0;this.emitTimeBuffer-=e)this.emitParticle()}}else this.destroy();debugParticles&&debugRect(this.pos,w(this.emitSize),"#0f0",0,this.angle)}emitParticle(){let e=null!=this.emitSize.x?new z(rand(-.5,.5),rand(-.5,.5)).multiply(this.emitSize).rotate(this.angle):randInCircle(this.emitSize/2),t=rand(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(e=this.pos.add(e),t+=this.angle);const i=new Yt(e,this.tileIndex,this.tileSize,t),s=this.randomness,a=e=>e+e*rand(s,-s),n=a(this.particleTime),o=a(this.sizeStart),l=a(this.sizeEnd),r=a(this.speed),c=a(this.angleSpeed)*randSign(),h=rand(this.emitConeAngle,-this.emitConeAngle),d=randColor(this.colorStartA,this.colorStartB,this.randomColorLinear),u=randColor(this.colorEndA,this.colorEndB,this.randomColorLinear),m=this.localSpace?h:this.angle+h;return i.colorStart=d,i.colorEndDelta=u.subtract(d),i.velocity=(new z).setAngle(m,r),i.angleVelocity=c,i.lifeTime=n,i.sizeStart=o,i.sizeEndDelta=l-o,i.fadeRate=this.fadeRate,i.damping=this.damping,i.angleDamping=this.angleDamping,i.elasticity=this.elasticity,i.friction=this.friction,i.gravityScale=this.gravityScale,i.collideTiles=this.collideTiles,i.additive=this.additive,i.renderOrder=this.renderOrder,i.trailScale=this.trailScale,i.mirror=randInt(2),i.localSpaceEmitter=this.localSpace&&this,i.destroyCallback=this.particleDestroyCallback,this.particleCreateCallback&&this.particleCreateCallback(i),i}render(){}}class Yt extends EngineObject{constructor(e,t,i,s){super(e,new z,t,i,s)}render(){const e=min((time-this.spawnTime)/this.lifeTime,1),t=this.sizeStart+e*this.sizeEndDelta,i=new z(t,t),s=this.fadeRate/2,a=new D(this.colorStart.r+e*this.colorEndDelta.r,this.colorStart.g+e*this.colorEndDelta.g,this.colorStart.b+e*this.colorEndDelta.b,(this.colorStart.a+e*this.colorEndDelta.a)*(e<s?e/s:e>1-s?(1-e)/s:1));this.additive&&setBlendMode(1);let n=this.pos,o=this.angle;if(this.localSpaceEmitter&&(n=this.localSpaceEmitter.pos.add(n.rotate(-this.localSpaceEmitter.angle)),o+=this.localSpaceEmitter.angle),this.trailScale){let e=this.velocity;this.localSpaceEmitter&&(e=e.rotate(-this.localSpaceEmitter.angle));const t=e.length(),s=e.scale(1/t),l=t*this.trailScale;i.y=max(i.x,l),o=s.angle(),drawTile(n.add(s.multiply(w(0,-l/2))),i,this.tileIndex,this.tileSize,a,o,this.mirror)}else drawTile(n,i,this.tileIndex,this.tileSize,a,o,this.mirror);this.additive&&setBlendMode(),debugParticles&&debugRect(n,i,"#f005",0,o),1==e&&(this.color=a,this.size=i,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}let Jt=[],Xt=w();function Qt(e){Xt=e,Jt=[];for(let e=Jt.length=Xt.area();e--;)Jt[e]=0}const qt=(e,t=0)=>e.arrayCheck(Xt)&&(Jt[(0|e.y)*Xt.x+e.x|0]=t),Vt=e=>e.arrayCheck(Xt)?Jt[(0|e.y)*Xt.x+e.x|0]:0;function Zt(e,t=w(),i){const s=max(e.x-t.x/2|0,0),a=max(e.y-t.y/2|0,0),n=min(e.x+t.x/2,Xt.x),o=min(e.y+t.y/2,Xt.y);for(let e=a;e<o;++e)for(let t=s;t<n;++t){const s=Jt[e*Xt.x+t];if(s&&(!i||i.collideWithTile(s,new z(t,e))))return 1}}function $t(e,t,i){const s=(t=t.floor()).subtract(e=e.floor()),a=abs(s.x),n=-abs(s.y),o=sign(s.x),l=sign(s.y);for(let s=e.x,r=e.y,c=a+n;;){const h=Vt(w(s,r));if(h&&(i?i.collideWithTileRaycast(h,new z(s,r)):h>0))return debugRaycast&&debugLine(e,t,"#f00",.02,1),debugRaycast&&debugPoint(new z(s+.5,r+.5),"#ff0",1),new z(s+.5,r+.5);if(s==t.x&r==t.y)break;const d=2*c;d>=n&&(c+=n,s+=o),d<=a&&(c+=a,r+=l)}debugRaycast&&debugLine(e,t,"#00f",.02,1)}class ei{constructor(e,t=0,i=0,s=new D){this.tile=e,this.direction=t,this.mirror=i,this.color=s}clear(){this.tile=this.direction=this.mirror=0,color=new D}}class ti extends EngineObject{constructor(e,t=Xt,i=tileSizeDefault,s=w(1),a=0){super(e,t,-1,i,0,void 0,a),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=s,this.isOverlay,this.data=[];for(let e=this.size.area();e--;)this.data.push(new ei)}setData(e,t,i){e.arrayCheck(this.size)&&(this.data[(0|e.y)*this.size.x+e.x|0]=t,i&&this.drawTileData(e))}getData(e){return e.arrayCheck(this.size)&&this.data[(0|e.y)*this.size.x+e.x|0]}update(){}render(){ASSERT(mainContext!=this.context),glEnable&&!glOverlay&&!this.isOverlay&&glCopyToContext(mainContext);const e=worldToScreen(this.pos.add(w(0,this.size.y*this.scale.y)));(this.isOverlay?overlayContext:mainContext).drawImage(this.canvas,e.x,e.y,cameraScale*this.size.x*this.scale.x,cameraScale*this.size.y*this.scale.y)}redraw(){this.redrawStart(1),this.drawAllTileData(),this.redrawEnd()}redrawStart(e=0){this.savedRenderSettings=[mainCanvas,mainContext,mainCanvasSize,cameraPos,cameraScale],mainCanvas=this.canvas,mainContext=this.context,cameraPos=this.size.scale(.5),cameraScale=this.tileSize.x,e&&(mainCanvas.width=this.size.x*this.tileSize.x,mainCanvas.height=this.size.y*this.tileSize.y),enginePreRender()}redrawEnd(){ASSERT(mainContext==this.context),glEnable&&glCopyToContext(mainContext,1),[mainCanvas,mainContext,mainCanvasSize,cameraPos,cameraScale]=this.savedRenderSettings}drawTileData(e){const t=e.floor().add(this.pos).add(w(.5));this.drawCanvas2D(t,w(1),0,0,(e=>e.clearRect(-.5,-.5,1,1)));const i=this.getData(e);null!=i.tile&&(ASSERT(mainContext==this.context),drawTile(t,w(1),i.tile,this.tileSize,i.color,i.direction*PI/2,i.mirror))}drawAllTileData(){for(let e=this.size.x;e--;)for(let t=this.size.y;t--;)this.drawTileData(w(e,t))}drawCanvas2D(e,t,i=0,s,a){const n=this.context;n.save(),e=e.subtract(this.pos).multiply(this.tileSize),t=t.multiply(this.tileSize),n.translate(e.x,this.canvas.height-e.y),n.rotate(i),n.scale(s?-t.x:t.x,t.y),a(n),n.restore()}drawTile(e,t=w(1),i=-1,s=tileSizeDefault,a=new D,n,o){this.drawCanvas2D(e,t,n,o,(e=>{if(i<0)e.fillStyle=a,e.fillRect(-.5,-.5,1,1);else{const t=tileImage.width/s.x;e.globalAlpha=a.a,e.drawImage(tileImage,i%t*s.x,(i/t|0)*s.y,s.x,s.y,-.5,-.5,1,1)}}))}drawRect(e,t,i,s){this.drawTile(e,t,-1,0,i,s)}}let ii,si,ai,ni,oi,li=w(),ri=32,ci=w(1920,1200),hi=w(),di=1,ui="arial",mi=1,gi=1,pi=w(16),yi=.3,Si=1,xi=1,fi=1,vi=1,bi=0,Ci=.8,wi=1,Ai=0,zi=1,Ti=1,Ei=1,Di=1,Ii=0,Mi=1,Ri=99,Pi=.3,Bi=1,Oi=1,Fi=.5,ji=40,ki=.7,Gi=5,Wi=.5,Li=w(640,80),_i=50;function Ki(e){}function Ni(e=ni){ai.bindTexture(Xi,e)}function Ui(e,t){const i=ai.createShader(t);if(ai.shaderSource(i,e),ai.compileShader(i),debug&&!ai.getShaderParameter(i,os))throw ai.getShaderInfoLog(i);return i}function Hi(e,t){const i=ai.createProgram();if(ai.attachShader(i,Ui(e,ns)),ai.attachShader(i,Ui(t,as)),ai.linkProgram(i),debug&&!ai.getProgramParameter(i,ls))throw ai.getProgramInfoLog(i);return i}function Yi(e){const t=ai.createTexture();ai.bindTexture(Xi,t),e&&e.width&&ai.texImage2D(Xi,0,qi,qi,Qi,e);const i=cavasPixelated?Vi:Zi;return ai.texParameteri(Xi,es,i),ai.texParameteri(Xi,$i,i),ai.texParameteri(Xi,ts,ss),ai.texParameteri(Xi,is,ss),t}function Ji(e,t){ASSERT(!oi),e||(e="void mainImage(out vec4 c,vec2 p){c=texture2D(iChannel0,p/iResolution.xy);}"),oi=Hi("precision highp float;attribute vec2 p;void main(){gl_Position=vec4(p,1,1);}","precision highp float;uniform sampler2D iChannel0;uniform vec3 iResolution;uniform float iTime;\n"+e+"\nvoid main(){mainImage(gl_FragColor,gl_FragCoord.xy);gl_FragColor.a=1.;}"),ai.createBuffer(),Yi(),mainCanvas.style.visibility="hidden"}const Xi=3553,Qi=5121,qi=6408,Vi=9728,Zi=9729,$i=10240,es=10241,ts=10242,is=10243,ss=33071,as=35632,ns=35633,os=35713,ls=35714;export{D as Color,Ut as EngineObject,Ce as FontImage,gt as Medal,Y as Music,yt as Newgrounds,e as PI,Yt as Particle,Ht as ParticleEmitter,H as Sound,ti as TileLayer,ei as TileLayerData,I as Timer,z as Vector2,t as abs,V as audioContext,li as cameraPos,ri as cameraScale,hi as canvasFixedSize,ci as canvasMaxSize,di as cavasPixelated,o as clamp,vt as clearInput,Se as drawCanvas2D,ye as drawLine,me as drawRect,pe as drawRectScreenSpace,fe as drawText,ve as drawTextScreen,ue as drawTile,ge as drawTileScreenSpace,Si as enablePhysicsSolver,be as engineFontImage,_ as engineInit,M as engineName,O as engineObjects,U as engineObjectsCallback,F as engineObjectsCollide,N as engineObjectsDestroy,K as engineObjectsUpdate,R as engineVersion,ui as fontDefault,m as formatTime,j as frame,P as frameRate,Ei as gamepadDirectionEmulateStick,It as gamepadIsDown,Pt as gamepadStick,Mt as gamepadWasPressed,Rt as gamepadWasReleased,Ti as gamepadsEnable,kt as gamepadsUpdate,q as getNoteFrequency,Vt as getTileCollisionData,si as glCanvas,Ui as glCompileShader,ai as glContext,Hi as glCreateProgram,Yi as glCreateTexture,mi as glEnable,Ji as glInitPostProcess,gi as glOverlay,Ki as glSetBlendMode,Ni as glSetTexture,ni as glTileTexture,Ai as gravity,E as hsl,Qt as initTileCollision,Di as inputWASDEmulateDirection,we as isFullscreen,d as isOverlapping,Lt as isTouchDevice,Et as isUsingGamepad,A as isVector2,St as keyIsDown,xt as keyWasPressed,ft as keyWasReleased,r as lerp,ie as mainCanvas,oe as mainCanvasSize,se as mainContext,s as max,_i as medalDisplayIconSize,Li as medalDisplaySize,Wi as medalDisplaySlideTime,Gi as medalDisplayTime,mt as medalsInit,ii as medalsPreventUnlock,i as min,n as mod,bt as mouseIsDown,At as mousePos,zt as mousePosScreen,Ft as mouseToScreen,Ct as mouseWasPressed,wt as mouseWasReleased,Tt as mouseWheel,h as nearestPowerOfTwo,pt as newgroundsInit,vi as objectDefaultAngleDamping,fi as objectDefaultDamping,bi as objectDefaultElasticity,Ci as objectDefaultFriction,xi as objectDefaultMass,wi as objectMaxSpeed,ae as overlayCanvas,ne as overlayContext,zi as particleEmitRateScale,W as paused,l as percent,J as playAudioFile,Z as playSamples,Dt as preventDefaultInput,g as rand,f as randColor,S as randInCircle,p as randInt,v as randSeed,C as randSeeded,y as randSign,x as randVector,T as rgb,he as screenToWorld,xe as setBlendMode,ze as setCameraPos,Te as setCameraScale,De as setCanvasFixedSize,Ee as setCanvasMaxSize,Ie as setCavasPixelated,ct as setDebugKey,Fe as setEnablePhysicsSolver,Me as setFontDefault,He as setGamepadDirectionEmulateStick,Ue as setGamepadsEnable,Re as setGlEnable,Pe as setGlOverlay,rt as setGodMode,Ke as setGravity,Ye as setInputWASDEmulateDirection,nt as setMedalDisplayIconSize,at as setMedalDisplaySize,st as setMedalDisplaySlideTime,it as setMedalDisplayTime,ot as setMedalsPreventUnlock,Ge as setObjectDefaultAngleDamping,ke as setObjectDefaultDamping,We as setObjectDefaultElasticity,Le as setObjectDefaultFriction,je as setObjectDefaultMass,_e as setObjectMaxSpeed,Ne as setParticleEmitRateScale,L as setPaused,b as setRandSeed,lt as setShowWatermark,et as setSoundDefaultRange,tt as setSoundDefaultTaper,Ze as setSoundEnable,$e as setSoundVolume,qt as setTileCollisionData,Oe as setTileFixBleedScale,Be as setTileSizeDefault,qe as setTouchGamepadAlpha,Xe as setTouchGamepadAnalog,Je as setTouchGamepadEnable,Qe as setTouchGamepadSize,Ve as setVibrateEnable,a as sign,c as smoothStep,ji as soundDefaultRange,ki as soundDefaultTaper,Oi as soundEnable,Fi as soundVolume,X as speak,Q as speakStop,Jt as tileCollision,$t as tileCollisionRaycast,Xt as tileCollisionSize,Zt as tileCollisionTest,yi as tileFixBleedScale,le as tileImage,pi as tileSizeDefault,k as time,B as timeDelta,G as timeReal,Ae as toggleFullscreen,Pi as touchGamepadAlpha,Mi as touchGamepadAnalog,Ii as touchGamepadEnable,Ri as touchGamepadSize,w as vec2,Gt as vibrate,Bi as vibrateEnable,Wt as vibrateStop,u as wave,de as worldToScreen,$ as zzfx};
