var LittleJS=function(e){"use strict";const t=Math.PI,i=e=>e<0?-e:e,s=(e,t=0,i=1)=>e<t?t:e>i?i:e,a=(e,t=0,i=1)=>i-t?s((e-t)/(i-t)):0,n=(e=1,t=0)=>t+(e-t)*Math.random(),o=(e=1,t=0)=>0|n(e,t),l=(e=1)=>(new h).setAngle(n(2*t),e);e.randSeed=1;const r=(e=0,t)=>null==e.x?new h(e,null==t?e:t):new h(e.x,e.y),c=e=>!isNaN(e.x)&&!isNaN(e.y);class h{constructor(e=0,t=0){this.x=e,this.y=t}copy(){return new h(this.x,this.y)}add(e){return ASSERT(c(e)),new h(this.x+e.x,this.y+e.y)}subtract(e){return ASSERT(c(e)),new h(this.x-e.x,this.y-e.y)}multiply(e){return ASSERT(c(e)),new h(this.x*e.x,this.y*e.y)}divide(e){return ASSERT(c(e)),new h(this.x/e.x,this.y/e.y)}scale(e){return ASSERT(!c(e)),new h(this.x*e,this.y*e)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(e){return this.distanceSquared(e)**.5}distanceSquared(e){return(this.x-e.x)**2+(this.y-e.y)**2}normalize(e=1){const t=this.length();return t?this.scale(e/t):new h(0,e)}clampLength(e=1){const t=this.length();return t>e?this.scale(e/t):this}dot(e){return ASSERT(c(e)),this.x*e.x+this.y*e.y}cross(e){return ASSERT(c(e)),this.x*e.y-this.y*e.x}angle(){return Math.atan2(this.x,this.y)}setAngle(e=0,t=1){return this.x=t*Math.sin(e),this.y=t*Math.cos(e),this}rotate(e){const t=Math.cos(e),i=Math.sin(e);return new h(this.x*t-this.y*i,this.x*i+this.y*t)}direction(){return i(this.x)>i(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new h(this.y,-this.x)}floor(){return new h(Math.floor(this.x),Math.floor(this.y))}area(){return i(this.x*this.y)}lerp(e,t){return ASSERT(c(e)),this.add(e.subtract(this).scale(s(t)))}arrayCheck(e){return this.x>=0&&this.y>=0&&this.x<e.x&&this.y<e.y}toString(e=3){if(debug)return`(${(this.x<0?"":" ")+this.x.toFixed(e)},${(this.y<0?"":" ")+this.y.toFixed(e)} )`}}class d{constructor(e=1,t=1,i=1,s=1){this.r=e,this.g=t,this.b=i,this.a=s}copy(){return new d(this.r,this.g,this.b,this.a)}add(e){return new d(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}subtract(e){return new d(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}multiply(e){return new d(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}divide(e){return new d(this.r/e.r,this.g/e.g,this.b/e.b,this.a/e.a)}scale(e,t=e){return new d(this.r*e,this.g*e,this.b*e,this.a*t)}clamp(){return new d(s(this.r),s(this.g),s(this.b),s(this.a))}lerp(e,t){return this.add(e.subtract(this).scale(s(t)))}setHSLA(e=0,t=0,i=1,s=1){const a=i<.5?i*(1+t):i+t-i*t,n=2*i-a,o=(e,t,i)=>(i=(i%1+1)%1)<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e;return this.r=o(n,a,e+1/3),this.g=o(n,a,e),this.b=o(n,a,e-1/3),this.a=s,this}getHSLA(){const e=s(this.r),t=s(this.g),i=s(this.b),a=s(this.a),n=Math.max(e,t,i),o=Math.min(e,t,i),l=(n+o)/2;let r=0,c=0;if(n!=o){let s=n-o;c=l>.5?s/(2-n-o):s/(n+o),e==n?r=(t-i)/s+(t<i?6:0):t==n?r=(i-e)/s+2:i==n&&(r=(e-t)/s+4)}return[r/6,c,l,a]}mutate(e=.05,t=0){return new d(this.r+n(e,-e),this.g+n(e,-e),this.b+n(e,-e),this.a+n(t,-t)).clamp()}toString(e=1){const t=e=>((e=255*e|0)<16?"0":"")+e.toString(16);return"#"+t(this.r)+t(this.g)+t(this.b)+(e?t(this.a):"")}setHex(e){const t=t=>s(parseInt(e.slice(t,t+2),16)/255);return this.r=t(1),this.g=t(3),this.b=t(5),this.a=e.length>7?t(7):1,this}rgbaInt(){const e=e=>255*s(e)|0;return e(this.r)+(e(this.g)<<8)+(e(this.b)<<16)+(e(this.a)<<24)}}class u{constructor(e){this.time=null==e?void 0:time+e,this.setTime=e}set(e=0){this.time=time+e,this.setTime=e}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return time<=this.time}elapsed(){return time>this.time}get(){return this.isSet()?time-this.time:0}getPercent(){return this.isSet()?a(this.time-time,this.setTime,0):0}toString(){if(debug)return this.unset()?"unset":Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after")}valueOf(){return this.get()}}const m="LittleJS",g="1.6.3",p=60,y=1/p;function S(){e.engineObjectsCollide=e.engineObjects.filter((e=>e.collideSolidObjects));const t=e=>{if(!e.destroyed){e.update();for(const i of e.children)t(i)}};for(const i of e.engineObjects)i.parent||t(i);e.engineObjects=e.engineObjects.filter((e=>!e.destroyed)),e.time=++e.frame/p}e.engineObjects=[],e.engineObjectsCollide=[],e.frame=0,e.time=0,e.timeReal=0,e.paused=0;function x(t,i=1,s=1,a=0,n=0){if(!soundEnable)return;if(e.audioContext||(e.audioContext=new AudioContext),e.audioContext.resume(),"running"!=e.audioContext.state)return;const o=e.audioContext.createBuffer(t.length,t[0].length,f),l=e.audioContext.createBufferSource();t.forEach(((e,t)=>o.getChannelData(t).set(e))),l.buffer=o,l.playbackRate.value=s,l.loop=n;const r=e.audioContext.createGain();return r.gain.value=soundVolume*i,r.connect(e.audioContext.destination),l.connect(new StereoPannerNode(e.audioContext,{pan:clamp(a,-1,1)})).connect(r),l.start(),l}e.audioContext=void 0;const f=44100;function v(e=1,t=.05,i=220,s=0,a=0,n=.1,o=0,l=1,r=0,c=0,h=0,d=0,u=0,m=0,g=0,p=0,y=0,S=1,x=0,v=0){let b,C,w=2*PI,T=r*=500*w/f/f,z=[],A=i*=(1+t*rand(-1,1))*w/f,D=0,E=0,I=0,P=1,R=0,M=0,O=0;for(c*=500*w/f**3,g*=w/f,h*=w/f,d*=f,u=u*f|0,C=(s=s*f+9)+(x*=f)+(a*=f)+(n*=f)+(y*=f)|0;I<C;z[I++]=O)++M%(100*p|0)||(O=o?o>1?o>2?o>3?Math.sin((D%w)**3):max(min(Math.tan(D),1),-1):1-(2*D/w%2+2)%2:1-4*abs(Math.round(D/w)-D/w):Math.sin(D),O=(u?1-v+v*Math.sin(w*I/u):1)*sign(O)*abs(O)**l*e*soundVolume*(I<s?I/s:I<s+x?1-(I-s)/x*(1-S):I<s+x+a?S:I<C-y?(C-I-y)/n*S:0),O=y?O/2+(y>I?0:(I<C-y?1:(C-I)/y)*z[I-y|0]/2):O),b=(i+=r+=c)*Math.cos(g*E++),D+=b-b*m*(1-1e9*(Math.sin(I)+1)%2),P&&++P>d&&(i+=h,A+=h,P=0),!u||++R%u||(i=A,r=T,P||=1);return z}let b,C=[];const w=(...e)=>console.assert(...e),T=(e,t=r(),i="#fff",s=0,a=0,n=!1)=>{w("string"==typeof i),C.push({pos:e,size:r(t),color:i,time:new u(s),angle:a,fill:n})},z=(e,t=0)=>O[t]&&1&O[t][e],A=(e,t=0)=>O[t]&&2&O[t][e]?1:0,D=(e,t=0)=>O[t]&&4&O[t][e]?1:0,E=z,I=A,P=D;let R=r();e.mousePosScreen=r(),e.mouseWheel=0,e.isUsingGamepad=0;const M=(e,t=0)=>z(e,t+1);let O=[[]];onkeydown=t=>{debug&&t.target!=document.body||t.repeat||(O[e.isUsingGamepad=0][j(t.which)]=3)},onkeyup=e=>{debug&&e.target!=document.body||(O[0][j(e.which)]=4)};const j=e=>inputWASDEmulateDirection?87==e?38:83==e?40:65==e?37:68==e?39:e:e;onmousedown=t=>{O[e.isUsingGamepad=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=e=>O[0][e.button]=2&O[0][e.button]|4,onmousemove=t=>e.mousePosScreen=F(t),onwheel=t=>t.ctrlKey||(e.mouseWheel=sign(t.deltaY)),oncontextmenu=e=>!1;const F=e=>{if(!mainCanvas)return r();const t=mainCanvas.getBoundingClientRect();return r(mainCanvas.width,mainCanvas.height).multiply(r(percent(e.x,t.left,t.right),percent(e.y,t.top,t.bottom)))},B=[];const k=e=>vibrateEnable&&navigator&&navigator.vibrate&&navigator.vibrate(e),G=void 0!==window.ontouchstart;if(G){let t,i=onmousedown,s=onmouseup;onmousedown=onmouseup=()=>0,ontouchstart=a=>(zzfx(0),ontouchstart=ontouchmove=ontouchend=e=>{e.button=0;const a=e.touches.length;return a?(e.x=e.touches[0].clientX,e.y=e.touches[0].clientY,t?onmousemove(e):i(e)):t&&s(e),t=a,!0},touchGamepadEnable&&function(){W=[],L=r();let t=ontouchstart;ontouchstart=ontouchmove=ontouchend=i=>{L=r(),W=[];if(i.touches.length&&(K.set(),paused))return void(W[9]=1);const s=r(touchGamepadSize,mainCanvasSize.y-touchGamepadSize),a=mainCanvasSize.subtract(r(touchGamepadSize,touchGamepadSize)),n=mainCanvasSize.scale(.5);for(const e of i.touches){const t=F(r(e.clientX,e.clientY));if(t.distance(s)<touchGamepadSize)if(touchGamepadAnalog)L=t.subtract(s).scale(2/touchGamepadSize).clampLength();else{const e=t.subtract(s).angle();L.setAngle((4*e/PI+8.5|0)*PI/4)}else if(t.distance(a)<touchGamepadSize){const e=t.subtract(a).direction();W[e]=1}else t.distance(n)<touchGamepadSize&&(W[9]=1)}return t(i),e.isUsingGamepad=1,!0}}(),ontouchstart(a))}let W,L,U,N,K=new u;let _=r();const H=new Image;let J,Y;const X=e=>(ASSERT(_.x&&_.y,"mainCanvasSize is invalid"),e.add(r(.5)).subtract(_.scale(.5)).multiply(r(1/cameraScale,-1/cameraScale)).add(cameraPos)),Q=e=>(ASSERT(_.x&&_.y,"mainCanvasSize is invalid"),e.subtract(cameraPos).multiply(r(cameraScale,-cameraScale)).add(_.scale(.5)).subtract(r(.5)));function q(e,t=r(1),i=-1,s=tileSizeDefault,a=new d,n=0,o,l=new d(0,0,0,0),c=glEnable){if(showWatermark&&0,glEnable&&c)if(i<0||!H.width)glDraw(e.x,e.y,t.x,t.y,n,0,0,0,0,0,a.rgbaInt());else{const r=J.x/s.x|0,c=s.x/J.x,h=s.y/J.y,d=i%r*c,u=(i/r|0)*h;glDraw(e.x,e.y,o?-t.x:t.x,t.y,n,d+Y.x,u+Y.y,d-Y.x+c,u-Y.y+h,a.rgbaInt(),l.rgbaInt())}else $(e,t,n,o,(e=>{if(i<0)e.fillStyle=a,e.fillRect(-.5,-.5,1,1);else{const t=J.x/s.x|0,n=i%t*s.x+tileFixBleedScale,o=(i/t|0)*s.y+tileFixBleedScale,l=s.x-2*tileFixBleedScale,r=s.y-2*tileFixBleedScale;e.globalAlpha=a.a,e.drawImage(H,n,o,l,r,-.5,-.5,1,1)}}))}function V(e,t,i,s,a){q(e,t,-1,tileSizeDefault,i,s,0,0,a)}function Z(e,t=r(1),i,s,a,n,o,l,c){q(X(e),t.scale(1/cameraScale),i,s,a,n,o,l,c)}function $(e,t,i,s,a,n=U){e=Q(e),t=t.scale(cameraScale),n.save(),n.translate(e.x+.5|0,e.y+.5|0),n.rotate(i),n.scale(s?-t.x:t.x,t.y),a(n),n.restore()}function ee(e,t,i=1,s=new d,a=0,n=new d(0,0,0),o="center",l=fontDefault,r=N){r.fillStyle=s,r.lineWidth=a,r.strokeStyle=n,r.textAlign=o,r.font=i+"px "+l,r.textBaseline="middle",r.lineJoin="round",t=t.copy(),(e+"").split("\n").forEach((e=>{a&&r.strokeText(e,t.x,t.y),r.fillText(e,t.x,t.y),t.y+=i}))}e.engineFontImage=void 0;const te=()=>document.fullscreenElement;const ie=[];let se,ae;class ne{constructor(e,t){ASSERT(!ae&&e),this.app_id=e,this.cipher=t,this.host=location?location.hostname:"",t&&(this.cryptoJS=this.CryptoJS());const i=new URL(location.href);if(this.session_id=i.searchParams.get("ngio_session_id"),!this.session_id)return;const s=this.call("Medal.getList");this.medals=s?s.result.data.medals:[],debugMedals&&console.log(this.medals);for(const e of this.medals){const t=ie[e.id];t&&(t.image=new Image,t.image.src=e.icon,t.name=e.name,t.description=e.description,t.unlocked=e.unlocked,t.difficulty=e.difficulty,t.value=e.value,t.value&&(t.description=t.description+" ("+t.value+")"))}const a=this.call("ScoreBoard.getBoards");this.scoreboards=a?a.result.data.scoreboards:[],debugMedals&&console.log(this.scoreboards);setInterval((()=>this.call("Gateway.ping",0,1)),3e5)}unlockMedal(e){return this.call("Medal.unlock",{id:e},1)}postScore(e,t){return this.call("ScoreBoard.postScore",{id:e,value:t},1)}getScores(e,t=0,i=0,s=0,a=10){return this.call("ScoreBoard.getScores",{id:e,user:t,social:i,skip:s,limit:a})}logView(){return this.call("App.logView",{host:this.host},1)}call(e,t=0,i=0){const s={component:e,parameters:t};if(this.cipher){const e=this.cryptoJS,t=e.enc.Base64.parse(this.cipher),i=e.lib.WordArray.random(16),a=e.AES.encrypt(JSON.stringify(s),t,{iv:i});s.secure=e.enc.Base64.stringify(i.concat(a.ciphertext)),s.parameters=0}const a={app_id:this.app_id,session_id:this.session_id,call:s},n=new FormData;n.append("input",JSON.stringify(a));const o=new XMLHttpRequest;return o.open("POST","https://newgrounds.io/gateway_v3.php",!debugMedals&&i),o.send(n),debugMedals&&console.log(o.responseText),o.responseText&&JSON.parse(o.responseText)}CryptoJS(){return Function("[M='GBMGXz^oVYPPKKbB`agTXU|LxPc_ZBcMrZvCr~wyGfWrwk@ATqlqeTp^N?p{we}jIpEnB_sEr`l?YDkDhWhprc|Er|XETG?pTl`e}dIc[_N~}fzRycIfpW{HTolvoPB_FMe_eH~BTMx]yyOhv?biWPCGc]kABencBhgERHGf{OL`Dj`c^sh@canhy[secghiyotcdOWgO{tJIE^JtdGQRNSCrwKYciZOa]Y@tcRATYKzv|sXpboHcbCBf`}SKeXPFM|RiJsSNaIb]QPc[D]Jy_O^XkOVTZep`ONmntLL`Qz~UupHBX_Ia~WX]yTRJIxG`ioZ{fefLJFhdyYoyLPvqgH?b`[TMnTwwfzDXhfM?rKs^aFr|nyBdPmVHTtAjXoYUloEziWDCw_suyYT~lSMksI~ZNCS[Bex~j]Vz?kx`gdYSEMCsHpjbyxQvw|XxX_^nQYue{sBzVWQKYndtYQMWRef{bOHSfQhiNdtR{o?cUAHQAABThwHPT}F{VvFmgN`E@FiFYS`UJmpQNM`X|tPKHlccT}z}k{sACHL?Rt@MkWplxO`ASgh?hBsuuP|xD~LSH~KBlRs]t|l|_tQAroDRqWS^SEr[sYdPB}TAROtW{mIkE|dWOuLgLmJrucGLpebrAFKWjikTUzS|j}M}szasKOmrjy[?hpwnEfX[jGpLt@^v_eNwSQHNwtOtDgWD{rk|UgASs@mziIXrsHN_|hZuxXlPJOsA^^?QY^yGoCBx{ekLuZzRqQZdsNSx@ezDAn{XNj@fRXIwrDX?{ZQHwTEfu@GhxDOykqts|n{jOeZ@c`dvTY?e^]ATvWpb?SVyg]GC?SlzteilZJAL]mlhLjYZazY__qcVFYvt@|bIQnSno@OXyt]OulzkWqH`rYFWrwGs`v|~XeTsIssLrbmHZCYHiJrX}eEzSssH}]l]IhPQhPoQ}rCXLyhFIT[clhzYOvyHqigxmjz`phKUU^TPf[GRAIhNqSOdayFP@FmKmuIzMOeoqdpxyCOwCthcLq?n`L`tLIBboNn~uXeFcPE{C~mC`h]jUUUQe^`UqvzCutYCgct|SBrAeiYQW?X~KzCz}guXbsUw?pLsg@hDArw?KeJD[BN?GD@wgFWCiHq@Ypp_QKFixEKWqRp]oJFuVIEvjDcTFu~Zz]a{IcXhWuIdMQjJ]lwmGQ|]g~c]Hl]pl`Pd^?loIcsoNir_kikBYyg?NarXZEGYspt_vLBIoj}LI[uBFvm}tbqvC|xyR~a{kob|HlctZslTGtPDhBKsNsoZPuH`U`Fqg{gKnGSHVLJ^O`zmNgMn~{rsQuoymw^JY?iUBvw_~mMr|GrPHTERS[MiNpY[Mm{ggHpzRaJaoFomtdaQ_?xuTRm}@KjU~RtPsAdxa|uHmy}n^i||FVL[eQAPrWfLm^ndczgF~Nk~aplQvTUpHvnTya]kOenZlLAQIm{lPl@CCTchvCF[fI{^zPkeYZTiamoEcKmBMfZhk_j_~Fjp|wPVZlkh_nHu]@tP|hS@^G^PdsQ~f[RqgTDqezxNFcaO}HZhb|MMiNSYSAnQWCDJukT~e|OTgc}sf[cnr?fyzTa|EwEtRG|I~|IO}O]S|rp]CQ}}DWhSjC_|z|oY|FYl@WkCOoPuWuqr{fJu?Brs^_EBI[@_OCKs}?]O`jnDiXBvaIWhhMAQDNb{U`bqVR}oqVAvR@AZHEBY@depD]OLh`kf^UsHhzKT}CS}HQKy}Q~AeMydXPQztWSSzDnghULQgMAmbWIZ|lWWeEXrE^EeNoZApooEmrXe{NAnoDf`m}UNlRdqQ@jOc~HLOMWs]IDqJHYoMziEedGBPOxOb?[X`KxkFRg@`mgFYnP{hSaxwZfBQqTm}_?RSEaQga]w[vxc]hMne}VfSlqUeMo_iqmd`ilnJXnhdj^EEFifvZyxYFRf^VaqBhLyrGlk~qowqzHOBlOwtx?i{m~`n^G?Yxzxux}b{LSlx]dS~thO^lYE}bzKmUEzwW^{rPGhbEov[Plv??xtyKJshbG`KuO?hjBdS@Ru}iGpvFXJRrvOlrKN?`I_n_tplk}kgwSXuKylXbRQ]]?a|{xiT[li?k]CJpwy^o@ebyGQrPfF`aszGKp]baIx~H?ElETtFh]dz[OjGl@C?]VDhr}OE@V]wLTc[WErXacM{We`F|utKKjgllAxvsVYBZ@HcuMgLboFHVZmi}eIXAIFhS@A@FGRbjeoJWZ_NKd^oEH`qgy`q[Tq{x?LRP|GfBFFJV|fgZs`MLbpPYUdIV^]mD@FG]pYAT^A^RNCcXVrPsgk{jTrAIQPs_`mD}rOqAZA[}RETFz]WkXFTz_m{N@{W@_fPKZLT`@aIqf|L^Mb|crNqZ{BVsijzpGPEKQQZGlApDn`ruH}cvF|iXcNqK}cxe_U~HRnKV}sCYb`D~oGvwG[Ca|UaybXea~DdD~LiIbGRxJ_VGheI{ika}KC[OZJLn^IBkPrQj_EuoFwZ}DpoBRcK]Q}?EmTv~i_Tul{bky?Iit~tgS|o}JL_VYcCQdjeJ_MfaA`FgCgc[Ii|CBHwq~nbJeYTK{e`CNstKfTKPzw{jdhp|qsZyP_FcugxCFNpKitlR~vUrx^NrSVsSTaEgnxZTmKc`R|lGJeX}ccKLsQZQhsFkeFd|ckHIVTlGMg`~uPwuHRJS_CPuN_ogXe{Ba}dO_UBhuNXby|h?JlgBIqMKx^_u{molgL[W_iavNQuOq?ap]PGB`clAicnl@k~pA?MWHEZ{HuTLsCpOxxrKlBh]FyMjLdFl|nMIvTHyGAlPogqfZ?PlvlFJvYnDQd}R@uAhtJmDfe|iJqdkYr}r@mEjjIetDl_I`TELfoR|qTBu@Tic[BaXjP?dCS~MUK[HPRI}OUOwAaf|_}HZzrwXvbnNgltjTwkBE~MztTQhtRSWoQHajMoVyBBA`kdgK~h`o[J`dm~pm]tk@i`[F~F]DBlJKklrkR]SNw@{aG~Vhl`KINsQkOy?WhcqUMTGDOM_]bUjVd|Yh_KUCCgIJ|LDIGZCPls{RzbVWVLEhHvWBzKq|^N?DyJB|__aCUjoEgsARki}j@DQXS`RNU|DJ^a~d{sh_Iu{ONcUtSrGWW@cvUjefHHi}eSSGrNtO?cTPBShLqzwMVjWQQCCFB^culBjZHEK_{dO~Q`YhJYFn]jq~XSnG@[lQr]eKrjXpG~L^h~tDgEma^AUFThlaR{xyuP@[^VFwXSeUbVetufa@dX]CLyAnDV@Bs[DnpeghJw^?UIana}r_CKGDySoRudklbgio}kIDpA@McDoPK?iYcG?_zOmnWfJp}a[JLR[stXMo?_^Ng[whQlrDbrawZeSZ~SJstIObdDSfAA{MV}?gNunLOnbMv_~KFQUAjIMj^GkoGxuYtYbGDImEYiwEMyTpMxN_LSnSMdl{bg@dtAnAMvhDTBR_FxoQgANniRqxd`pWv@rFJ|mWNWmh[GMJz_Nq`BIN@KsjMPASXORcdHjf~rJfgZYe_uulzqM_KdPlMsuvU^YJuLtofPhGonVOQxCMuXliNvJIaoC?hSxcxKVVxWlNs^ENDvCtSmO~WxI[itnjs^RDvI@KqG}YekaSbTaB]ki]XM@[ZnDAP~@|BzLRgOzmjmPkRE@_sobkT|SszXK[rZN?F]Z_u}Yue^[BZgLtR}FHzWyxWEX^wXC]MJmiVbQuBzkgRcKGUhOvUc_bga|Tx`KEM`JWEgTpFYVeXLCm|mctZR@uKTDeUONPozBeIkrY`cz]]~WPGMUf`MNUGHDbxZuO{gmsKYkAGRPqjc|_FtblEOwy}dnwCHo]PJhN~JoteaJ?dmYZeB^Xd?X^pOKDbOMF@Ugg^hETLdhwlA}PL@_ur|o{VZosP?ntJ_kG][g{Zq`Tu]dzQlSWiKfnxDnk}KOzp~tdFstMobmy[oPYjyOtUzMWdjcNSUAjRuqhLS@AwB^{BFnqjCmmlk?jpn}TksS{KcKkDboXiwK]qMVjm~V`LgWhjS^nLGwfhAYrjDSBL_{cRus~{?xar_xqPlArrYFd?pHKdMEZzzjJpfC?Hv}mAuIDkyBxFpxhstTx`IO{rp}XGuQ]VtbHerlRc_LFGWK[XluFcNGUtDYMZny[M^nVKVeMllQI[xtvwQnXFlWYqxZZFp_|]^oWX[{pOMpxXxvkbyJA[DrPzwD|LW|QcV{Nw~U^dgguSpG]ClmO@j_TENIGjPWwgdVbHganhM?ema|dBaqla|WBd`poj~klxaasKxGG^xbWquAl~_lKWxUkDFagMnE{zHug{b`A~IYcQYBF_E}wiA}K@yxWHrZ{[d~|ARsYsjeNWzkMs~IOqqp[yzDE|WFrivsidTcnbHFRoW@XpAV`lv_zj?B~tPCppRjgbbDTALeFaOf?VcjnKTQMLyp{NwdylHCqmo?oelhjWuXj~}{fpuX`fra?GNkDiChYgVSh{R[BgF~eQa^WVz}ATI_CpY?g_diae]|ijH`TyNIF}|D_xpmBq_JpKih{Ba|sWzhnAoyraiDvk`h{qbBfsylBGmRH}DRPdryEsSaKS~tIaeF[s]I~xxHVrcNe@Jjxa@jlhZueLQqHh_]twVMqG_EGuwyab{nxOF?`HCle}nBZzlTQjkLmoXbXhOtBglFoMz?eqre`HiE@vNwBulglmQjj]DB@pPkPUgA^sjOAUNdSu_`oAzar?n?eMnw{{hYmslYi[TnlJD'",..."]charCodeAtUinyxpf","for(;e<10359;c[e++]=p-=128,A=A?p-A&&A:p==34&&p)for(p=1;p<128;y=f.map((n,x)=>(U=r[n]*2+1,U=Math.log(U/(h-U)),t-=a[x]*U,U/500)),t=~-h/(1+Math.exp(t))|1,i=o%h<t,o=o%h+(i?t:h-t)*(o>>17)-!i*t,f.map((n,x)=>(U=r[n]+=(i*h/2-r[n]<<13)/((C[n]+=C[n]<5)+1/20)>>13,a[x]+=y[x]*(i-t/h))),p=p*2+i)for(f='010202103203210431053105410642065206541'.split(t=0).map((n,x)=>(U=0,[...n].map((n,x)=>(U=U*997+(c[e-n]|0)|0)),h*32-1&U*997+p+!!A*129)*12+x);o<h*32;o=o*64|M.charCodeAt(d++)&63);for(C=String.fromCharCode(...c);r=/[\0-#?@\\\\~]/.exec(C);)with(C.split(r))C=join(shift());return C")([],[],1<<17,[0,0,0,0,0,0,0,0,0,0,0,0],new Uint16Array(51e6).fill(32768),new Uint8Array(51e6),0,0,0,0)()}}class oe extends EngineObject{constructor(e,t,i=0,s=0,a=100,n=PI,o=-1,l=tileSizeDefault,r=new d,c=new d,u=new d(1,1,1,0),m=new d(1,1,1,0),g=.5,p=.1,y=1,S=.1,x=.05,f=1,v=1,b=0,C=PI,w=.1,T=.2,z,A,D=1,E=(A?1e9:0),I){super(e,new h,o,l,t,void 0,E),this.emitSize=i,this.emitTime=s,this.emitRate=a,this.emitConeAngle=n,this.colorStartA=r,this.colorStartB=c,this.colorEndA=u,this.colorEndB=m,this.randomColorLinear=D,this.particleTime=g,this.sizeStart=p,this.sizeEnd=y,this.speed=S,this.angleSpeed=x,this.damping=f,this.angleDamping=v,this.gravityScale=b,this.particleConeAngle=C,this.fadeRate=w,this.randomness=T,this.collideTiles=z,this.additive=A,this.localSpace=I,this.trailScale=0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime|this.getAliveTime()<=this.emitTime){if(this.emitRate*particleEmitRateScale){const e=1/this.emitRate/particleEmitRateScale;for(this.emitTimeBuffer+=timeDelta;this.emitTimeBuffer>0;this.emitTimeBuffer-=e)this.emitParticle()}}else this.destroy();debugParticles&&debugRect(this.pos,r(this.emitSize),"#0f0",0,this.angle)}emitParticle(){let e=null!=this.emitSize.x?new h(rand(-.5,.5),rand(-.5,.5)).multiply(this.emitSize).rotate(this.angle):randInCircle(this.emitSize/2),t=rand(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(e=this.pos.add(e),t+=this.angle);const i=new le(e,this.tileIndex,this.tileSize,t),s=this.randomness,a=e=>e+e*rand(s,-s),n=a(this.particleTime),o=a(this.sizeStart),l=a(this.sizeEnd),r=a(this.speed),c=a(this.angleSpeed)*randSign(),d=rand(this.emitConeAngle,-this.emitConeAngle),u=randColor(this.colorStartA,this.colorStartB,this.randomColorLinear),m=randColor(this.colorEndA,this.colorEndB,this.randomColorLinear),g=this.localSpace?d:this.angle+d;return i.colorStart=u,i.colorEndDelta=m.subtract(u),i.velocity=(new h).setAngle(g,r),i.angleVelocity=c,i.lifeTime=n,i.sizeStart=o,i.sizeEndDelta=l-o,i.fadeRate=this.fadeRate,i.damping=this.damping,i.angleDamping=this.angleDamping,i.elasticity=this.elasticity,i.friction=this.friction,i.gravityScale=this.gravityScale,i.collideTiles=this.collideTiles,i.additive=this.additive,i.renderOrder=this.renderOrder,i.trailScale=this.trailScale,i.mirror=randInt(2),i.localSpaceEmitter=this.localSpace&&this,i.destroyCallback=this.particleDestroyCallback,this.particleCreateCallback&&this.particleCreateCallback(i),i}render(){}}class le extends EngineObject{constructor(e,t,i,s){super(e,new h,t,i,s)}render(){const e=min((time-this.spawnTime)/this.lifeTime,1),t=this.sizeStart+e*this.sizeEndDelta,i=new h(t,t),s=this.fadeRate/2,a=new d(this.colorStart.r+e*this.colorEndDelta.r,this.colorStart.g+e*this.colorEndDelta.g,this.colorStart.b+e*this.colorEndDelta.b,(this.colorStart.a+e*this.colorEndDelta.a)*(e<s?e/s:e>1-s?(1-e)/s:1));this.additive&&setBlendMode(1);let n=this.pos,o=this.angle;if(this.localSpaceEmitter&&(n=this.localSpaceEmitter.pos.add(n.rotate(-this.localSpaceEmitter.angle)),o+=this.localSpaceEmitter.angle),this.trailScale){let e=this.velocity;this.localSpaceEmitter&&(e=e.rotate(-this.localSpaceEmitter.angle));const t=e.length(),s=e.scale(1/t),l=t*this.trailScale;i.y=max(i.x,l),o=s.angle(),drawTile(n.add(s.multiply(r(0,-l/2))),i,this.tileIndex,this.tileSize,a,o,this.mirror)}else drawTile(n,i,this.tileIndex,this.tileSize,a,o,this.mirror);this.additive&&setBlendMode(),debugParticles&&debugRect(n,i,"#f005",0,o),1==e&&(this.color=a,this.size=i,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}e.tileCollision=[],e.tileCollisionSize=r();const re=t=>t.arrayCheck(e.tileCollisionSize)?e.tileCollision[(0|t.y)*e.tileCollisionSize.x+t.x|0]:0;class ce{constructor(e,t=0,i=0,s=new d){this.tile=e,this.direction=t,this.mirror=i,this.color=s}clear(){this.tile=this.direction=this.mirror=0,color=new d}}class he extends EngineObject{constructor(t,i=e.tileCollisionSize,s=tileSizeDefault,a=r(1),n=0){super(t,i,-1,s,0,void 0,n),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=a,this.isOverlay,this.data=[];for(let e=this.size.area();e--;)this.data.push(new ce)}setData(e,t,i){e.arrayCheck(this.size)&&(this.data[(0|e.y)*this.size.x+e.x|0]=t,i&&this.drawTileData(e))}getData(e){return e.arrayCheck(this.size)&&this.data[(0|e.y)*this.size.x+e.x|0]}update(){}render(){ASSERT(mainContext!=this.context),glEnable&&!glOverlay&&!this.isOverlay&&glCopyToContext(mainContext);const e=worldToScreen(this.pos.add(r(0,this.size.y*this.scale.y)));(this.isOverlay?overlayContext:mainContext).drawImage(this.canvas,e.x,e.y,cameraScale*this.size.x*this.scale.x,cameraScale*this.size.y*this.scale.y)}redraw(){this.redrawStart(1),this.drawAllTileData(),this.redrawEnd()}redrawStart(e=0){this.savedRenderSettings=[mainCanvas,mainContext,mainCanvasSize,cameraPos,cameraScale],mainCanvas=this.canvas,mainContext=this.context,cameraPos=this.size.scale(.5),cameraScale=this.tileSize.x,e&&(mainCanvas.width=this.size.x*this.tileSize.x,mainCanvas.height=this.size.y*this.tileSize.y),enginePreRender()}redrawEnd(){ASSERT(mainContext==this.context),glEnable&&glCopyToContext(mainContext,1),[mainCanvas,mainContext,mainCanvasSize,cameraPos,cameraScale]=this.savedRenderSettings}drawTileData(e){const t=e.floor().add(this.pos).add(r(.5));this.drawCanvas2D(t,r(1),0,0,(e=>e.clearRect(-.5,-.5,1,1)));const i=this.getData(e);null!=i.tile&&(ASSERT(mainContext==this.context),drawTile(t,r(1),i.tile,this.tileSize,i.color,i.direction*PI/2,i.mirror))}drawAllTileData(){for(let e=this.size.x;e--;)for(let t=this.size.y;t--;)this.drawTileData(r(e,t))}drawCanvas2D(e,t,i=0,s,a){const n=this.context;n.save(),e=e.subtract(this.pos).multiply(this.tileSize),t=t.multiply(this.tileSize),n.translate(e.x,this.canvas.height-e.y),n.rotate(i),n.scale(s?-t.x:t.x,t.y),a(n),n.restore()}drawTile(e,t=r(1),i=-1,s=tileSizeDefault,a=new d,n,o){this.drawCanvas2D(e,t,n,o,(e=>{if(i<0)e.fillStyle=a,e.fillRect(-.5,-.5,1,1);else{const t=tileImage.width/s.x;e.globalAlpha=a.a,e.drawImage(tileImage,i%t*s.x,(i/t|0)*s.y,s.x,s.y,-.5,-.5,1,1)}}))}drawRect(e,t,i,s){this.drawTile(e,t,-1,0,i,s)}}let de,ue,me,ge=r(),pe=r(1920,1200),ye=r(),Se=r(16),xe=r(640,80);function fe(e,t){const i=de.createShader(t);if(de.shaderSource(i,e),de.compileShader(i),debug&&!de.getShaderParameter(i,je))throw de.getShaderInfoLog(i);return i}function ve(e,t){const i=de.createProgram();if(de.attachShader(i,fe(e,Oe)),de.attachShader(i,fe(t,Me)),de.linkProgram(i),debug&&!de.getProgramParameter(i,Fe))throw de.getProgramInfoLog(i);return i}function be(e){const t=de.createTexture();de.bindTexture(Ce,t),e&&e.width&&de.texImage2D(Ce,0,Te,Te,we,e);const i=cavasPixelated?ze:Ae;return de.texParameteri(Ce,Ee,i),de.texParameteri(Ce,De,i),de.texParameteri(Ce,Ie,Re),de.texParameteri(Ce,Pe,Re),t}const Ce=3553,we=5121,Te=6408,ze=9728,Ae=9729,De=10240,Ee=10241,Ie=10242,Pe=10243,Re=33071,Me=35632,Oe=35633,je=35713,Fe=35714;return e.ASSERT=w,e.Color=d,e.EngineObject=class{constructor(e=r(),t=r(1),i=-1,s=tileSizeDefault,a=0,n,o=0){ASSERT(isVector2(e)&&isVector2(t)),this.pos=e.copy(),this.size=t,this.drawSize,this.tileIndex=i,this.tileSize=s,this.angle=a,this.color=n,this.additiveColor,this.mass=objectDefaultMass,this.damping=objectDefaultDamping,this.angleDamping=objectDefaultAngleDamping,this.elasticity=objectDefaultElasticity,this.friction=objectDefaultFriction,this.gravityScale=1,this.renderOrder=o,this.velocity=new h,this.angleVelocity=0,this.spawnTime=time,this.children=[],this.collideTiles=1,engineObjects.push(this)}update(){const e=this.parent;if(e)return this.pos=this.localPos.multiply(r(e.getMirrorSign(),1)).rotate(-e.angle).add(e.pos),void(this.angle=e.getMirrorSign()*this.localAngle+e.angle);this.velocity.x=clamp(this.velocity.x,-objectMaxSpeed,objectMaxSpeed),this.velocity.y=clamp(this.velocity.y,-objectMaxSpeed,objectMaxSpeed);const t=this.pos.copy();if(this.velocity.y+=gravity*this.gravityScale,this.pos.x+=this.velocity.x*=this.damping,this.pos.y+=this.velocity.y*=this.damping,this.angle+=this.angleVelocity*=this.angleDamping,ASSERT(this.angleDamping>=0&&this.angleDamping<=1),ASSERT(this.damping>=0&&this.damping<=1),!enablePhysicsSolver||!this.mass)return;const i=this.velocity.y<0;if(this.groundObject){const e=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=e+(this.velocity.x-e)*this.friction,this.groundObject=0}if(this.collideSolidObjects){const e=.001;for(const s of engineObjectsCollide){if(!this.isSolid&!s.isSolid||s.destroyed||s.parent||s==this)continue;if(!isOverlapping(this.pos,this.size,s.pos,s.size))continue;if(!this.collideWithObject(s)|!s.collideWithObject(this))continue;if(isOverlapping(t,this.size,s.pos,s.size)){const e=t.subtract(s.pos),i=e.length(),a=.001,n=i<.01?randVector(a):e.scale(a/i);this.velocity=this.velocity.add(n),s.mass&&(s.velocity=s.velocity.subtract(n)),debugOverlay&&debugPhysics&&debugAABB(this.pos,this.size,s.pos,s.size,"#f00");continue}const a=this.size.add(s.size),n=2*(t.y-s.pos.y)>a.y+gravity,o=2*abs(t.y-s.pos.y)<a.y,l=2*abs(t.x-s.pos.x)<a.x,r=max(this.elasticity,s.elasticity);if(n|l|!o)if(this.pos.y=s.pos.y+(a.y/2+e)*sign(t.y-s.pos.y),s.groundObject&&i||!s.mass)i&&(this.groundObject=s),this.velocity.y*=-r;else if(s.mass){const e=(this.mass*this.velocity.y+s.mass*s.velocity.y)/(this.mass+s.mass),t=this.velocity.y*(this.mass-s.mass)/(this.mass+s.mass)+2*s.velocity.y*s.mass/(this.mass+s.mass),i=s.velocity.y*(s.mass-this.mass)/(this.mass+s.mass)+2*this.velocity.y*this.mass/(this.mass+s.mass);this.velocity.y=lerp(r,e,t),s.velocity.y=lerp(r,e,i)}if(!n&o)if(this.pos.x=s.pos.x+(a.x/2+e)*sign(t.x-s.pos.x),s.mass){const e=(this.mass*this.velocity.x+s.mass*s.velocity.x)/(this.mass+s.mass),t=this.velocity.x*(this.mass-s.mass)/(this.mass+s.mass)+2*s.velocity.x*s.mass/(this.mass+s.mass),i=s.velocity.x*(s.mass-this.mass)/(this.mass+s.mass)+2*this.velocity.x*this.mass/(this.mass+s.mass);this.velocity.x=lerp(r,e,t),s.velocity.x=lerp(r,e,i)}else this.velocity.x*=-r;debugOverlay&&debugPhysics&&debugAABB(this.pos,this.size,s.pos,s.size,"#f0f")}}if(this.collideTiles&&tileCollisionTest(this.pos,this.size,this)&&!tileCollisionTest(t,this.size,this)){const e=tileCollisionTest(new h(t.x,this.pos.y),this.size,this),s=tileCollisionTest(new h(this.pos.x,t.y),this.size,this);if(e|!s){this.groundObject=i,this.velocity.y*=-this.elasticity;const e=(t.y-this.size.y/2|0)-(t.y-this.size.y/2);e<0&&e>this.damping*this.velocity.y+gravity*this.gravityScale&&(this.velocity.y=this.damping?(e-gravity*this.gravityScale)/this.damping:0),this.pos.y=t.y}s&&(this.pos.x=t.x,this.velocity.x*=-this.elasticity)}}render(){drawTile(this.pos,this.drawSize||this.size,this.tileIndex,this.tileSize,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const e of this.children)e.destroy(e.parent=0)}}collideWithTile(e,t){return e>0}collideWithTileRaycast(e,t){return e>0}collideWithObject(e){return 1}getAliveTime(){return time-this.spawnTime}applyAcceleration(e){this.mass&&(this.velocity=this.velocity.add(e))}applyForce(e){this.applyAcceleration(e.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(e,t=r(),i=0){ASSERT(!e.parent&&!this.children.includes(e)),this.children.push(e),e.parent=this,e.localPos=t.copy(),e.localAngle=i}removeChild(e){ASSERT(e.parent==this&&this.children.includes(e)),this.children.splice(this.children.indexOf(e),1),e.parent=0}setCollision(e=1,t=1,i=1){ASSERT(e||!t),this.collideSolidObjects=e,this.isSolid=t,this.collideTiles=i}toString(){if(debug){let e="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(e+="\npos = "+this.pos),(this.velocity.x||this.velocity.y)&&(e+="\nvelocity = "+this.velocity),(this.size.x||this.size.y)&&(e+="\nsize = "+this.size),this.angle&&(e+="\nangle = "+this.angle.toFixed(3)),this.color&&(e+="\ncolor = "+this.color),e}}},e.FontImage=class{constructor(t,i=r(8),s=r(0,1),a=0,n=N){e.engineFontImage||((e.engineFontImage=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=t||e.engineFontImage,this.tileSize=i,this.paddingSize=s,this.startTileIndex=a,this.context=n}drawTextScreen(e,t,i=4,s){const a=this.context;a.save(),a.imageSmoothingEnabled=!cavasPixelated;const n=this.tileSize,o=n.add(this.paddingSize).scale(i),l=this.image.width/this.tileSize.x|0;(e+"").split("\n").forEach(((e,c)=>{const h=s?e.length*n.x*i/2|0:0;for(let s=e.length;s--;){let d=e[s].charCodeAt();(d<32||d>127)&&(d=127);const u=this.startTileIndex+d-32,m=u%l,g=u/l|0,p=t.add(r(s,c).multiply(o));a.drawImage(this.image,m*n.x,g*n.y,n.x,n.y,p.x-h,p.y,n.x*i,n.y*i)}})),a.restore()}drawText(e,t,i=1,s){this.drawTextScreen(e,Q(t).floor(),i*cameraScale|0,s)}},e.Medal=class{constructor(e,t,i="",s="ðŸ†",a){ASSERT(e>=0&&!ie[e]),ie[this.id=e]=this,this.name=t,this.description=i,this.icon=s,a&&((this.image=new Image).src=a)}unlock(){medalsPreventUnlock||this.unlocked||(ASSERT(se),localStorage[this.storageKey()]=this.unlocked=1,ae&&ae.unlockMedal(this.id))}render(e=0){const t=overlayContext,i=min(medalDisplaySize.x,mainCanvas.width),s=overlayCanvas.width-i,a=-medalDisplaySize.y*e;t.save(),t.beginPath(),t.fillStyle=new d(.9,.9,.9),t.strokeStyle=new d(0,0,0),t.lineWidth=3,t.fill(t.rect(s,a,i,medalDisplaySize.y)),t.stroke(),t.clip(),this.renderIcon(r(s+15+medalDisplayIconSize/2,a+medalDisplaySize.y/2));const n=r(s+medalDisplayIconSize+30,a+28);drawTextScreen(this.name,n,38,new d(0,0,0),0,0,"left"),n.y+=32,drawTextScreen(this.description,n,24,new d(0,0,0),0,0,"left"),t.restore()}renderIcon(e,t=medalDisplayIconSize){this.image?overlayContext.drawImage(this.image,e.x-t/2,e.y-t/2,t,t):drawTextScreen(this.icon,e,.7*t,new d(0,0,0))}storageKey(){return se+"_"+this.id}},e.Music=class{constructor(e){soundEnable&&(this.cachedSamples=function(e,t,i,s=125){let a,n,o,l,r,c,h,d,u,m,g,p,y,S,x=0,b=[],C=[],w=[],T=0,z=0,A=1,D={},E=f/s*60>>2;for(;A;T++)b=[A=d=p=0],i.forEach(((s,f)=>{for(h=t[s][T]||[0,0,0],A|=!!t[s][T],S=p+(t[s][0].length-2-!d)*E,y=f==i.length-1,a=2,o=p;a<h.length+y;d=++a){for(r=h[a],u=a==h.length+y-1&&y||m!=(h[0]||0)|r|0,n=0;n<E&&d;n++>E-99&&u?g+=(g<1)/99:0)c=(1-g)*b[x++]/2||0,C[o]=(C[o]||0)-c*z+c,w[o]=(w[o++]||0)+c*z+c;r&&(g=r%1,z=h[1]||0,(r|=0)&&(b=D[[m=h[x=0]||0,r]]=D[[m,r]]||(l=[...e[m]],l[2]*=2**((r-12)/12),r>0?v(...l):[])))}p=S}));return[C,w]}(...e))}play(e,t=1){if(soundEnable)return this.source=x(this.cachedSamples,e,1,0,t)}stop(){this.source&&this.source.stop(),this.source=0}isPlaying(){return this.source}},e.Newgrounds=ne,e.PI=t,e.Particle=le,e.ParticleEmitter=oe,e.Sound=class{constructor(e,t=soundDefaultRange,i=soundDefaultTaper){soundEnable&&(this.range=t,this.taper=i,this.randomness=e[1]||0,e[1]=0,this.cachedSamples=v(...e))}play(e,t=1,i=1,s=1){if(!soundEnable)return;let a;if(e){const i=this.range;if(i){const s=cameraPos.distanceSquared(e);if(s>i*i)return;t*=percent(s**.5,i,i*this.taper)}a=2*worldToScreen(e).x/mainCanvas.width-1}const n=i+i*this.randomness*s*rand(-1,1);return x([this.cachedSamples],t,n,a)}playNote(e,t,i){if(soundEnable)return this.play(t,i,2**(e/12),0)}},e.TileLayer=he,e.TileLayerData=ce,e.Timer=u,e.Vector2=h,e.abs=i,e.cameraPos=ge,e.cameraScale=32,e.canvasFixedSize=ye,e.canvasMaxSize=pe,e.cavasPixelated=1,e.clamp=s,e.clearInput=()=>O=[[]],e.debug=1,e.debugAABB=(e,t,i,s,a)=>{const n=r(min(e.x-t.x/2,i.x-s.x/2),min(e.y-t.y/2,i.y-s.y/2)),o=r(max(e.x+t.x/2,i.x+s.x/2),max(e.y+t.y/2,i.y+s.y/2));T(n.lerp(o,.5),o.subtract(n),a)},e.debugCircle=(e,t=0,i="#fff",s=0,a=!1)=>{w("string"==typeof i),C.push({pos:e,size:t,color:i,time:new u(s),angle:0,fill:a})},e.debugClear=()=>C=[],e.debugKey=27,e.debugLine=(e,t,i,s=.1,a)=>{const n=r((t.x-e.x)/2,(t.y-e.y)/2),o=r(s,2*n.length());T(e.add(n),o,i,a,n.angle(),1)},e.debugPoint=(e,t,i,s)=>T(e,0,t,i,s),e.debugPointSize=.5,e.debugRect=T,e.debugSaveCanvas=(e,t=engineName+".png")=>{b.download="screenshot.png",b.href=e.toDataURL("image/png").replace("image/png","image/octet-stream"),b.click()},e.debugText=(e,t,i=1,s="#fff",a=0,n=0,o="monospace")=>{w("string"==typeof s),C.push({text:e,pos:t,size:i,color:s,time:new u(a),angle:n,font:o})},e.drawCanvas2D=$,e.drawLine=function(e,t,i=.1,s,a){const n=r((t.x-e.x)/2,(t.y-e.y)/2),o=r(i,2*n.length());V(e.add(n),o,s,n.angle(),a)},e.drawRect=V,e.drawRectScreenSpace=function(e,t,i,s,a){Z(e,t,-1,tileSizeDefault,i,s,0,0,a)},e.drawText=function(e,t,i=1,s,a=0,n,o,l,r){ee(e,Q(t),i*cameraScale,s,a*cameraScale,n,o,l,r)},e.drawTextScreen=ee,e.drawTile=q,e.drawTileScreenSpace=Z,e.enableAsserts=1,e.enablePhysicsSolver=1,e.engineInit=function(t,i,s,a,n,o){tileImage.onerror=tileImage.onload=()=>{tileImageFixBleed=r(tileFixBleedScale).divide(tileImageSize=r(tileImage.width,tileImage.height)),debug&&(tileImage.onload=()=>ASSERT(1));document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none",document.body.appendChild(mainCanvas=document.createElement("canvas")),mainContext=mainCanvas.getContext("2d"),debugInit(),glEnable&&glInit(),document.body.appendChild(overlayCanvas=document.createElement("canvas")),overlayContext=overlayCanvas.getContext("2d");(glCanvas||mainCanvas).style=mainCanvas.style=overlayCanvas.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)",t(),d()};let l,c,h=0;function d(t=0){let o=t-h;h=t,(debug||showWatermark)&&(c=lerp(.05,c,1e3/(o||1)));const u=debug&&keyIsDown(107),y=debug&&keyIsDown(109);if(debug&&(o*=u?5:y?.2:1),e.timeReal+=o/1e3,l+=!e.paused*o,u||(l=min(l,50)),canvasFixedSize.x){mainCanvas.width=canvasFixedSize.x,mainCanvas.height=canvasFixedSize.y;const e=innerWidth/innerHeight,t=mainCanvas.width/mainCanvas.height;(glCanvas||mainCanvas).style.width=mainCanvas.style.width=overlayCanvas.style.width=e<t?"100%":"",(glCanvas||mainCanvas).style.height=mainCanvas.style.height=overlayCanvas.style.height=e<t?"":"100%"}else mainCanvas.width=min(innerWidth,canvasMaxSize.x),mainCanvas.height=min(innerHeight,canvasMaxSize.y);if(overlayCanvas.width=mainCanvas.width,overlayCanvas.height=mainCanvas.height,mainCanvasSize=r(mainCanvas.width,mainCanvas.height),e.paused)inputUpdate(),debugUpdate(),s(),inputUpdatePost();else{let e=0;for(l<0&&l>-9&&(e=l,l=0);l>=0;l-=1e3/p)inputUpdate(),i(),S(),debugUpdate(),s(),inputUpdatePost();l+=e}mainCanvasSize=r(mainCanvas.width,mainCanvas.height),mainContext.imageSmoothingEnabled=!cavasPixelated,glEnable&&glPreRender(),a(),e.engineObjects.sort(((e,t)=>e.renderOrder-t.renderOrder));for(const t of e.engineObjects)t.destroyed||t.render();if(n(),glRenderPostProcess(),medalsRender(),touchGamepadRender(),debugRender(),glEnable&&glCopyToContext(mainContext),showWatermark){overlayContext.textAlign="right",overlayContext.textBaseline="top",overlayContext.font="1em monospace",overlayContext.fillStyle="#000";const t=m+" v"+g+" / "+drawCount+" / "+e.engineObjects.length+" / "+c.toFixed(1)+(glEnable?" GL":" 2D");overlayContext.fillText(t,mainCanvas.width-3,3),overlayContext.fillStyle="#fff",overlayContext.fillText(t,mainCanvas.width-2,2),drawCount=0}requestAnimationFrame(d)}o?tileImage.src=o:tileImage.onload()},e.engineName=m,e.engineObjectsCallback=function(t,i,s,a=e.engineObjects){if(t)if(null!=i.x)for(const e of a)isOverlapping(t,i,e.pos,e.size)&&s(e);else{const e=i*i;for(const i of a)t.distanceSquared(i.pos)<e&&s(i)}else for(const e of a)s(e)},e.engineObjectsDestroy=function(){for(const t of e.engineObjects)t.parent||t.destroy();e.engineObjects=e.engineObjects.filter((e=>!e.destroyed))},e.engineObjectsUpdate=S,e.engineVersion=g,e.fontDefault="arial",e.formatTime=e=>(e/60|0)+":"+(e%60<10?"0":"")+(e%60|0),e.frameRate=p,e.gamepadDirectionEmulateStick=1,e.gamepadIsDown=M,e.gamepadStick=(e,t=0)=>B[t]&&B[t][e]||r(),e.gamepadWasPressed=(e,t=0)=>A(e,t+1),e.gamepadWasReleased=(e,t=0)=>D(e,t+1),e.gamepadsEnable=1,e.gamepadsUpdate=function(){if(touchGamepadEnable&&K.isSet()){(B[0]||(B[0]=[]))[0]=r(L.x,-L.y);const e=O[1]||(O[1]=[]);for(let t=10;t--;){const i=3==t?2:2==t?3:t;e[i]=W[t]?1+2*!M(i,0):4*M(i,0)}}if(!gamepadsEnable||!navigator||!navigator.getGamepads||!document.hasFocus()&&!debug)return;const t=navigator.getGamepads();for(let i=t.length;i--;){const s=t[i],a=O[i+1]||(O[i+1]=[]),n=B[i]||(B[i]=[]);if(s){const t=.3,o=.8,l=e=>e>t?percent(e,t,o):e<-t?-percent(-e,t,o):0;for(let e=0;e<s.axes.length-1;e+=2)n[e>>1]=r(l(s.axes[e]),l(-s.axes[e+1])).clampLength();for(let t=s.buttons.length;t--;){const n=s.buttons[t];a[t]=n.pressed?1+2*!M(t,i):4*M(t,i),e.isUsingGamepad|=!i&&n.pressed,touchGamepadEnable&&K.unset()}if(gamepadDirectionEmulateStick){const e=r(M(15,i)-M(14,i),M(12,i)-M(13,i));e.lengthSquared()&&(n[0]=e.clampLength())}}}},e.getNoteFrequency=(e,t=220)=>t*2**(e/12),e.getTileCollisionData=re,e.glCanvas=undefined,e.glCompileShader=fe,e.glContext=de,e.glCreateProgram=ve,e.glCreateTexture=be,e.glEnable=1,e.glInitPostProcess=function(e,t){ASSERT(!me),e||(e="void mainImage(out vec4 c,vec2 p){c=texture2D(iChannel0,p/iResolution.xy);}"),me=ve("precision highp float;attribute vec2 p;void main(){gl_Position=vec4(p,1,1);}","precision highp float;uniform sampler2D iChannel0;uniform vec3 iResolution;uniform float iTime;\n"+e+"\nvoid main(){mainImage(gl_FragColor,gl_FragCoord.xy);gl_FragColor.a=1.;}"),de.createBuffer(),be(),mainCanvas.style.visibility="hidden"},e.glOverlay=1,e.glSetBlendMode=function(e){},e.glSetTexture=function(e=ue){de.bindTexture(Ce,e)},e.glTileTexture=ue,e.godMode=0,e.gravity=0,e.hsl=(e,t,i,s)=>(new d).setHSLA(e,t,i,s),e.initTileCollision=function(t){e.tileCollisionSize=t,e.tileCollision=[];for(let t=e.tileCollision.length=e.tileCollisionSize.area();t--;)e.tileCollision[t]=0},e.inputWASDEmulateDirection=1,e.isFullscreen=te,e.isOverlapping=(e,t,s,a)=>2*i(e.x-s.x)<t.x+a.x&&2*i(e.y-s.y)<t.y+a.y,e.isTouchDevice=G,e.isVector2=c,e.keyIsDown=z,e.keyWasPressed=A,e.keyWasReleased=D,e.lerp=(e,t=0,i=1)=>t+s(e)*(i-t),e.mainCanvas=undefined,e.mainCanvasSize=_,e.mainContext=U,e.max=(e,t)=>e>t?e:t,e.medalDisplayIconSize=50,e.medalDisplaySize=xe,e.medalDisplaySlideTime=.5,e.medalDisplayTime=5,e.medalsInit=function(e){se=e,debugMedals||ie.forEach((e=>e.unlocked=0|localStorage[e.storageKey()]))},e.medalsPreventUnlock=undefined,e.min=(e,t)=>e<t?e:t,e.mod=(e,t=1)=>(e%t+t)%t,e.mouseIsDown=E,e.mousePos=R,e.mouseToScreen=F,e.mouseWasPressed=I,e.mouseWasReleased=P,e.nearestPowerOfTwo=e=>2**Math.ceil(Math.log2(e)),e.newgroundsInit=function(e,t){ae=new ne(e,t)},e.objectDefaultAngleDamping=1,e.objectDefaultDamping=1,e.objectDefaultElasticity=0,e.objectDefaultFriction=.8,e.objectDefaultMass=1,e.objectMaxSpeed=1,e.overlayCanvas=undefined,e.overlayContext=N,e.particleEmitRateScale=1,e.percent=a,e.playAudioFile=function(e,t=1,i=1){if(!soundEnable)return;const s=new Audio(e);return s.volume=soundVolume*t,s.loop=i,s.play(),s},e.playSamples=x,e.preventDefaultInput=0,e.rand=n,e.randColor=(e=new d,t=new d(0,0,0,1),i)=>i?e.lerp(t,n()):new d(n(e.r,t.r),n(e.g,t.g),n(e.b,t.b),n(e.a,t.a)),e.randInCircle=(e=1,t=0)=>e>0?l(e*n(t/e,1)**.5):new h,e.randInt=o,e.randSeeded=(t=1,s=0)=>(e.randSeed^=e.randSeed<<13,e.randSeed^=e.randSeed>>>17,e.randSeed^=e.randSeed<<5,s+(t-s)*i(e.randSeed%1e9)/1e9),e.randSign=()=>2*o(2)-1,e.randVector=l,e.rgb=(e,t,i,s)=>new d(e,t,i,s),e.screenToWorld=X,e.setBlendMode=function(e,t=glEnable){glEnable&&t?glSetBlendMode(e):U.globalCompositeOperation=e?"lighter":"source-over"},e.setCameraPos=e=>cameraPos=e,e.setCameraScale=e=>cameraScale=e,e.setCanvasFixedSize=e=>canvasFixedSize=e,e.setCanvasMaxSize=e=>canvasMaxSize=e,e.setCavasPixelated=e=>cavasPixelated=e,e.setDebugKey=e=>debugKey=e,e.setEnablePhysicsSolver=e=>enablePhysicsSolver=e,e.setFontDefault=e=>fontDefault=e,e.setGamepadDirectionEmulateStick=e=>gamepadDirectionEmulateStick=e,e.setGamepadsEnable=e=>gamepadsEnable=e,e.setGlEnable=e=>glEnable=e,e.setGlOverlay=e=>glOverlay=e,e.setGodMode=e=>godMode=e,e.setGravity=e=>gravity=e,e.setInputWASDEmulateDirection=e=>inputWASDEmulateDirection=e,e.setMedalDisplayIconSize=e=>medalDisplayIconSize=e,e.setMedalDisplaySize=e=>medalDisplaySize=e,e.setMedalDisplaySlideTime=e=>medalDisplaySlideTime=e,e.setMedalDisplayTime=e=>medalDisplayTime=e,e.setMedalsPreventUnlock=e=>medalsPreventUnlock=e,e.setObjectDefaultAngleDamping=e=>objectDefaultAngleDamping=e,e.setObjectDefaultDamping=e=>objectDefaultDamping=e,e.setObjectDefaultElasticity=e=>objectDefaultElasticity=e,e.setObjectDefaultFriction=e=>objectDefaultFriction=e,e.setObjectDefaultMass=e=>objectDefaultMass=e,e.setObjectMaxSpeed=e=>objectMaxSpeed=e,e.setParticleEmitRateScale=e=>particleEmitRateScale=e,e.setPaused=function(t){e.paused=t},e.setRandSeed=t=>e.randSeed=t,e.setShowWatermark=e=>showWatermark=e,e.setSoundDefaultRange=e=>soundDefaultRange=e,e.setSoundDefaultTaper=e=>soundDefaultTaper=e,e.setSoundEnable=e=>soundEnable=e,e.setSoundVolume=e=>soundVolume=e,e.setTileCollisionData=(t,i=0)=>t.arrayCheck(e.tileCollisionSize)&&(e.tileCollision[(0|t.y)*e.tileCollisionSize.x+t.x|0]=i),e.setTileFixBleedScale=e=>tileFixBleedScale=e,e.setTileSizeDefault=e=>tileSizeDefault=e,e.setTouchGamepadAlpha=e=>touchGamepadAlpha=e,e.setTouchGamepadAnalog=e=>touchGamepadAnalog=e,e.setTouchGamepadEnable=e=>touchGamepadEnable=e,e.setTouchGamepadSize=e=>touchGamepadSize=e,e.setVibrateEnable=e=>vibrateEnable=e,e.showWatermark=1,e.sign=e=>e<0?-1:1,e.smoothStep=e=>e*e*(3-2*e),e.soundDefaultRange=40,e.soundDefaultTaper=.7,e.soundEnable=1,e.soundVolume=.5,e.speak=function(e,t="",i=1,s=1,a=1){if(!soundEnable||!speechSynthesis)return;const n=new SpeechSynthesisUtterance(e);return n.lang=t,n.volume=2*i*soundVolume,n.rate=s,n.pitch=a,speechSynthesis.speak(n),n},e.speakStop=()=>speechSynthesis&&speechSynthesis.cancel(),e.tileCollisionRaycast=function(e,t,i){const s=(t=t.floor()).subtract(e=e.floor()),a=abs(s.x),n=-abs(s.y),o=sign(s.x),l=sign(s.y);for(let s=e.x,c=e.y,d=a+n;;){const u=re(r(s,c));if(u&&(i?i.collideWithTileRaycast(u,new h(s,c)):u>0))return debugRaycast&&debugLine(e,t,"#f00",.02,1),debugRaycast&&debugPoint(new h(s+.5,c+.5),"#ff0",1),new h(s+.5,c+.5);if(s==t.x&c==t.y)break;const m=2*d;m>=n&&(d+=n,s+=o),m<=a&&(d+=a,c+=l)}debugRaycast&&debugLine(e,t,"#00f",.02,1)},e.tileCollisionTest=function(t,i=r(),s){const a=max(t.x-i.x/2|0,0),n=max(t.y-i.y/2|0,0),o=min(t.x+i.x/2,e.tileCollisionSize.x),l=min(t.y+i.y/2,e.tileCollisionSize.y);for(let t=n;t<l;++t)for(let i=a;i<o;++i){const a=e.tileCollision[t*e.tileCollisionSize.x+i];if(a&&(!s||s.collideWithTile(a,new h(i,t))))return 1}},e.tileFixBleedScale=.3,e.tileImage=H,e.tileSizeDefault=Se,e.timeDelta=y,e.toggleFullscreen=function(){te()?document.exitFullscreen&&document.exitFullscreen():document.body.requestFullscreen&&document.body.requestFullscreen()},e.touchGamepadAlpha=.3,e.touchGamepadAnalog=1,e.touchGamepadEnable=0,e.touchGamepadSize=99,e.vec2=r,e.vibrate=k,e.vibrateEnable=1,e.vibrateStop=()=>k(0),e.wave=(e=1,i=1,s=time)=>i/2*(1-Math.cos(s*e*2*t)),e.worldToScreen=Q,e.zzfx=(...e)=>x([v(...e)]),e}({});
